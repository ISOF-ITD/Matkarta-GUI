(function(){function b(r){return function(d,C,f,c){C=x(C,c,4);var b=!y(d)&&a.keys(d),e=(b||d).length,g=0<r?0:e-1;3>arguments.length&&(f=d[b?b[g]:g],g+=r);for(var h=C,k=f;0<=g&&g<e;g+=r)var m=b?b[g]:g,k=h(k,d[m],m,d);return k}}function l(a){return function(d,C,f){C=A(C,f);f=E(d);for(var c=0<a?0:f-1;0<=c&&c<f;c+=a)if(C(d[c],c,d))return c;return-1}}function n(r,d,f){return function(c,b,g){var e=0,h=E(c);if("number"==typeof g)0<r?e=0<=g?g:Math.max(g+h,e):h=0<=g?Math.min(g+1,h):g+h+1;else if(f&&g&&h)return g=
f(c,b),c[g]===b?g:-1;if(b!==b)return g=d(u.call(c,e,h),a.isNaN),0<=g?g+e:-1;for(g=0<r?e:h-1;0<=g&&g<h;g+=r)if(c[g]===b)return g;return-1}}function q(r,d){var f=K.length,g=r.constructor,g=a.isFunction(g)&&g.prototype||c,b="constructor";for(a.has(r,b)&&!a.contains(d,b)&&d.push(b);f--;)b=K[f],b in r&&r[b]!==g[b]&&!a.contains(d,b)&&d.push(b)}var e=this,p=e._,h=Array.prototype,c=Object.prototype,m=h.push,u=h.slice,k=c.toString,s=c.hasOwnProperty,t=Array.isArray,w=Object.keys,z=Function.prototype.bind,
B=Object.create,v=function(){},a=function(r){if(r instanceof a)return r;if(!(this instanceof a))return new a(r);this._wrapped=r};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=a),exports._=a):e._=a;a.VERSION="1.8.3";var x=function(a,d,f){if(void 0===d)return a;switch(null==f?3:f){case 1:return function(f){return a.call(d,f)};case 2:return function(f,C){return a.call(d,f,C)};case 3:return function(f,C,g){return a.call(d,f,C,g)};case 4:return function(f,
C,g,c){return a.call(d,f,C,g,c)}}return function(){return a.apply(d,arguments)}},A=function(r,d,f){return null==r?a.identity:a.isFunction(r)?x(r,d,f):a.isObject(r)?a.matcher(r):a.property(r)};a.iteratee=function(a,d){return A(a,d,Infinity)};var D=function(a,d){return function(f){var g=arguments.length;if(2>g||null==f)return f;for(var c=1;c<g;c++)for(var b=arguments[c],e=a(b),h=e.length,k=0;k<h;k++){var m=e[k];d&&void 0!==f[m]||(f[m]=b[m])}return f}},F=function(r){if(!a.isObject(r))return{};if(B)return B(r);
v.prototype=r;r=new v;v.prototype=null;return r},G=function(a){return function(d){return null==d?void 0:d[a]}},N=Math.pow(2,53)-1,E=G("length"),y=function(a){a=E(a);return"number"==typeof a&&0<=a&&a<=N};a.each=a.forEach=function(r,d,f){d=x(d,f);var g;if(y(r))for(f=0,g=r.length;f<g;f++)d(r[f],f,r);else{var c=a.keys(r);f=0;for(g=c.length;f<g;f++)d(r[c[f]],c[f],r)}return r};a.map=a.collect=function(r,d,f){d=A(d,f);f=!y(r)&&a.keys(r);for(var g=(f||r).length,c=Array(g),b=0;b<g;b++){var e=f?f[b]:b;c[b]=
d(r[e],e,r)}return c};a.reduce=a.foldl=a.inject=b(1);a.reduceRight=a.foldr=b(-1);a.find=a.detect=function(r,d,f){d=y(r)?a.findIndex(r,d,f):a.findKey(r,d,f);if(void 0!==d&&-1!==d)return r[d]};a.filter=a.select=function(r,d,f){var g=[];d=A(d,f);a.each(r,function(a,r,f){d(a,r,f)&&g.push(a)});return g};a.reject=function(r,d,f){return a.filter(r,a.negate(A(d)),f)};a.every=a.all=function(r,d,f){d=A(d,f);f=!y(r)&&a.keys(r);for(var g=(f||r).length,c=0;c<g;c++){var b=f?f[c]:c;if(!d(r[b],b,r))return!1}return!0};
a.some=a.any=function(r,d,f){d=A(d,f);f=!y(r)&&a.keys(r);for(var g=(f||r).length,c=0;c<g;c++){var b=f?f[c]:c;if(d(r[b],b,r))return!0}return!1};a.contains=a.includes=a.include=function(r,d,f,g){y(r)||(r=a.values(r));if("number"!=typeof f||g)f=0;return 0<=a.indexOf(r,d,f)};a.invoke=function(r,d){var f=u.call(arguments,2),g=a.isFunction(d);return a.map(r,function(a){var r=g?d:a[d];return null==r?r:r.apply(a,f)})};a.pluck=function(r,d){return a.map(r,a.property(d))};a.where=function(r,d){return a.filter(r,
a.matcher(d))};a.findWhere=function(r,d){return a.find(r,a.matcher(d))};a.max=function(r,d,f){var g=-Infinity,c=-Infinity,b;if(null==d&&null!=r){r=y(r)?r:a.values(r);for(var e=0,h=r.length;e<h;e++)f=r[e],f>g&&(g=f)}else d=A(d,f),a.each(r,function(a,r,f){b=d(a,r,f);if(b>c||-Infinity===b&&-Infinity===g)g=a,c=b});return g};a.min=function(r,d,f){var g=Infinity,c=Infinity,b;if(null==d&&null!=r){r=y(r)?r:a.values(r);for(var e=0,h=r.length;e<h;e++)f=r[e],f<g&&(g=f)}else d=A(d,f),a.each(r,function(a,r,f){b=
d(a,r,f);if(b<c||Infinity===b&&Infinity===g)g=a,c=b});return g};a.shuffle=function(r){r=y(r)?r:a.values(r);for(var d=r.length,f=Array(d),g=0,c;g<d;g++)c=a.random(0,g),c!==g&&(f[g]=f[c]),f[c]=r[g];return f};a.sample=function(d,f,g){return null==f||g?(y(d)||(d=a.values(d)),d[a.random(d.length-1)]):a.shuffle(d).slice(0,Math.max(0,f))};a.sortBy=function(d,f,g){f=A(f,g);return a.pluck(a.map(d,function(a,d,r){return{value:a,index:d,criteria:f(a,d,r)}}).sort(function(a,d){var r=a.criteria,f=d.criteria;if(r!==
f){if(r>f||void 0===r)return 1;if(r<f||void 0===f)return-1}return a.index-d.index}),"value")};var J=function(d){return function(f,g,c){var b={};g=A(g,c);a.each(f,function(a,c){var e=g(a,c,f);d(b,a,e)});return b}};a.groupBy=J(function(d,f,g){a.has(d,g)?d[g].push(f):d[g]=[f]});a.indexBy=J(function(a,d,f){a[f]=d});a.countBy=J(function(d,f,g){a.has(d,g)?d[g]++:d[g]=1});a.toArray=function(d){return d?a.isArray(d)?u.call(d):y(d)?a.map(d,a.identity):a.values(d):[]};a.size=function(d){return null==d?0:y(d)?
d.length:a.keys(d).length};a.partition=function(d,f,g){f=A(f,g);var c=[],b=[];a.each(d,function(a,d,r){(f(a,d,r)?c:b).push(a)});return[c,b]};a.first=a.head=a.take=function(d,f,g){return null==d?void 0:null==f||g?d[0]:a.initial(d,d.length-f)};a.initial=function(a,d,f){return u.call(a,0,Math.max(0,a.length-(null==d||f?1:d)))};a.last=function(d,f,g){return null==d?void 0:null==f||g?d[d.length-1]:a.rest(d,Math.max(0,d.length-f))};a.rest=a.tail=a.drop=function(a,d,f){return u.call(a,null==d||f?1:d)};a.compact=
function(d){return a.filter(d,a.identity)};var H=function(d,f,g,c){var b=[],e=0;c=c||0;for(var h=E(d);c<h;c++){var k=d[c];if(y(k)&&(a.isArray(k)||a.isArguments(k))){f||(k=H(k,f,g));var m=0,t=k.length;for(b.length+=t;m<t;)b[e++]=k[m++]}else g||(b[e++]=k)}return b};a.flatten=function(a,d){return H(a,d,!1)};a.without=function(d){return a.difference(d,u.call(arguments,1))};a.uniq=a.unique=function(d,f,g,c){a.isBoolean(f)||(c=g,g=f,f=!1);null!=g&&(g=A(g,c));c=[];for(var b=[],e=0,h=E(d);e<h;e++){var k=
d[e],m=g?g(k,e,d):k;f?(e&&b===m||c.push(k),b=m):g?a.contains(b,m)||(b.push(m),c.push(k)):a.contains(c,k)||c.push(k)}return c};a.union=function(){return a.uniq(H(arguments,!0,!0))};a.intersection=function(d){for(var f=[],g=arguments.length,c=0,b=E(d);c<b;c++){var e=d[c];if(!a.contains(f,e)){for(var h=1;h<g&&a.contains(arguments[h],e);h++);h===g&&f.push(e)}}return f};a.difference=function(d){var f=H(arguments,!0,!0,1);return a.filter(d,function(d){return!a.contains(f,d)})};a.zip=function(){return a.unzip(arguments)};
a.unzip=function(d){for(var f=d&&a.max(d,E).length||0,g=Array(f),c=0;c<f;c++)g[c]=a.pluck(d,c);return g};a.object=function(a,d){for(var f={},g=0,c=E(a);g<c;g++)d?f[a[g]]=d[g]:f[a[g][0]]=a[g][1];return f};a.findIndex=l(1);a.findLastIndex=l(-1);a.sortedIndex=function(a,d,f,g){f=A(f,g,1);d=f(d);g=0;for(var c=E(a);g<c;){var b=Math.floor((g+c)/2);f(a[b])<d?g=b+1:c=b}return g};a.indexOf=n(1,a.findIndex,a.sortedIndex);a.lastIndexOf=n(-1,a.findLastIndex);a.range=function(a,d,f){null==d&&(d=a||0,a=0);f=f||
1;d=Math.max(Math.ceil((d-a)/f),0);for(var g=Array(d),c=0;c<d;c++,a+=f)g[c]=a;return g};var L=function(d,f,g,c,b){if(!(c instanceof f))return d.apply(g,b);f=F(d.prototype);d=d.apply(f,b);return a.isObject(d)?d:f};a.bind=function(d,f){if(z&&d.bind===z)return z.apply(d,u.call(arguments,1));if(!a.isFunction(d))throw new TypeError("Bind must be called on a function");var g=u.call(arguments,2),c=function(){return L(d,c,f,this,g.concat(u.call(arguments)))};return c};a.partial=function(d){var f=u.call(arguments,
1),g=function(){for(var c=0,b=f.length,e=Array(b),h=0;h<b;h++)e[h]=f[h]===a?arguments[c++]:f[h];for(;c<arguments.length;)e.push(arguments[c++]);return L(d,g,this,this,e)};return g};a.bindAll=function(d){var f,g=arguments.length,c;if(1>=g)throw Error("bindAll must be passed function names");for(f=1;f<g;f++)c=arguments[f],d[c]=a.bind(d[c],d);return d};a.memoize=function(d,f){var g=function(c){var b=g.cache,e=""+(f?f.apply(this,arguments):c);a.has(b,e)||(b[e]=d.apply(this,arguments));return b[e]};g.cache=
{};return g};a.delay=function(a,d){var f=u.call(arguments,2);return setTimeout(function(){return a.apply(null,f)},d)};a.defer=a.partial(a.delay,a,1);a.throttle=function(d,f,g){var c,b,e,h=null,k=0;g||(g={});var m=function(){k=!1===g.leading?0:a.now();h=null;e=d.apply(c,b);h||(c=b=null)};return function(){var t=a.now();k||!1!==g.leading||(k=t);var s=f-(t-k);c=this;b=arguments;0>=s||s>f?(h&&(clearTimeout(h),h=null),k=t,e=d.apply(c,b),h||(c=b=null)):h||!1===g.trailing||(h=setTimeout(m,s));return e}};
a.debounce=function(d,f,g){var c,b,e,h,k,m=function(){var t=a.now()-h;t<f&&0<=t?c=setTimeout(m,f-t):(c=null,g||(k=d.apply(e,b),c||(e=b=null)))};return function(){e=this;b=arguments;h=a.now();var t=g&&!c;c||(c=setTimeout(m,f));t&&(k=d.apply(e,b),e=b=null);return k}};a.wrap=function(d,f){return a.partial(f,d)};a.negate=function(a){return function(){return!a.apply(this,arguments)}};a.compose=function(){var a=arguments,d=a.length-1;return function(){for(var f=d,g=a[d].apply(this,arguments);f--;)g=a[f].call(this,
g);return g}};a.after=function(a,d){return function(){if(1>--a)return d.apply(this,arguments)}};a.before=function(a,d){var f;return function(){0<--a&&(f=d.apply(this,arguments));1>=a&&(d=null);return f}};a.once=a.partial(a.before,2);var M=!{toString:null}.propertyIsEnumerable("toString"),K="valueOf isPrototypeOf toString propertyIsEnumerable hasOwnProperty toLocaleString".split(" ");a.keys=function(d){if(!a.isObject(d))return[];if(w)return w(d);var f=[],g;for(g in d)a.has(d,g)&&f.push(g);M&&q(d,f);
return f};a.allKeys=function(d){if(!a.isObject(d))return[];var f=[],g;for(g in d)f.push(g);M&&q(d,f);return f};a.values=function(d){for(var f=a.keys(d),g=f.length,c=Array(g),b=0;b<g;b++)c[b]=d[f[b]];return c};a.mapObject=function(d,f,g){f=A(f,g);g=a.keys(d);for(var c=g.length,b={},e,h=0;h<c;h++)e=g[h],b[e]=f(d[e],e,d);return b};a.pairs=function(d){for(var f=a.keys(d),g=f.length,c=Array(g),b=0;b<g;b++)c[b]=[f[b],d[f[b]]];return c};a.invert=function(d){for(var f={},g=a.keys(d),c=0,b=g.length;c<b;c++)f[d[g[c]]]=
g[c];return f};a.functions=a.methods=function(d){var f=[],g;for(g in d)a.isFunction(d[g])&&f.push(g);return f.sort()};a.extend=D(a.allKeys);a.extendOwn=a.assign=D(a.keys);a.findKey=function(d,f,g){f=A(f,g);g=a.keys(d);for(var c,b=0,e=g.length;b<e;b++)if(c=g[b],f(d[c],c,d))return c};a.pick=function(d,f,g){var c={},b=d,e,h;if(null==b)return c;a.isFunction(f)?(h=a.allKeys(b),e=x(f,g)):(h=H(arguments,!1,!1,1),e=function(d,a,f){return a in f},b=Object(b));for(var k=0,m=h.length;k<m;k++){var t=h[k],s=b[t];
e(s,t,b)&&(c[t]=s)}return c};a.omit=function(d,f,g){if(a.isFunction(f))f=a.negate(f);else{var c=a.map(H(arguments,!1,!1,1),String);f=function(d,f){return!a.contains(c,f)}}return a.pick(d,f,g)};a.defaults=D(a.allKeys,!0);a.create=function(d,f){var g=F(d);f&&a.extendOwn(g,f);return g};a.clone=function(d){return a.isObject(d)?a.isArray(d)?d.slice():a.extend({},d):d};a.tap=function(d,a){a(d);return d};a.isMatch=function(d,f){var g=a.keys(f),c=g.length;if(null==d)return!c;for(var b=Object(d),e=0;e<c;e++){var h=
g[e];if(f[h]!==b[h]||!(h in b))return!1}return!0};var I=function(d,f,g,c){if(d===f)return 0!==d||1/d===1/f;if(null==d||null==f)return d===f;d instanceof a&&(d=d._wrapped);f instanceof a&&(f=f._wrapped);var b=k.call(d);if(b!==k.call(f))return!1;switch(b){case "[object RegExp]":case "[object String]":return""+d===""+f;case "[object Number]":return+d!==+d?+f!==+f:0===+d?1/+d===1/f:+d===+f;case "[object Date]":case "[object Boolean]":return+d===+f}b="[object Array]"===b;if(!b){if("object"!=typeof d||
"object"!=typeof f)return!1;var e=d.constructor,h=f.constructor;if(e!==h&&!(a.isFunction(e)&&e instanceof e&&a.isFunction(h)&&h instanceof h)&&"constructor"in d&&"constructor"in f)return!1}g=g||[];c=c||[];for(e=g.length;e--;)if(g[e]===d)return c[e]===f;g.push(d);c.push(f);if(b){e=d.length;if(e!==f.length)return!1;for(;e--;)if(!I(d[e],f[e],g,c))return!1}else{b=a.keys(d);e=b.length;if(a.keys(f).length!==e)return!1;for(;e--;)if(h=b[e],!a.has(f,h)||!I(d[h],f[h],g,c))return!1}g.pop();c.pop();return!0};
a.isEqual=function(d,a){return I(d,a)};a.isEmpty=function(d){return null==d?!0:y(d)&&(a.isArray(d)||a.isString(d)||a.isArguments(d))?0===d.length:0===a.keys(d).length};a.isElement=function(d){return!(!d||1!==d.nodeType)};a.isArray=t||function(d){return"[object Array]"===k.call(d)};a.isObject=function(d){var a=typeof d;return"function"===a||"object"===a&&!!d};a.each("Arguments Function String Number Date RegExp Error".split(" "),function(d){a["is"+d]=function(a){return k.call(a)==="[object "+d+"]"}});
a.isArguments(arguments)||(a.isArguments=function(d){return a.has(d,"callee")});"function"!=typeof/./&&"object"!=typeof Int8Array&&(a.isFunction=function(d){return"function"==typeof d||!1});a.isFinite=function(d){return isFinite(d)&&!isNaN(parseFloat(d))};a.isNaN=function(d){return a.isNumber(d)&&d!==+d};a.isBoolean=function(d){return!0===d||!1===d||"[object Boolean]"===k.call(d)};a.isNull=function(d){return null===d};a.isUndefined=function(d){return void 0===d};a.has=function(d,a){return null!=d&&
s.call(d,a)};a.noConflict=function(){e._=p;return this};a.identity=function(d){return d};a.constant=function(d){return function(){return d}};a.noop=function(){};a.property=G;a.propertyOf=function(d){return null==d?function(){}:function(a){return d[a]}};a.matcher=a.matches=function(d){d=a.extendOwn({},d);return function(f){return a.isMatch(f,d)}};a.times=function(d,a,f){var g=Array(Math.max(0,d));a=x(a,f,1);for(f=0;f<d;f++)g[f]=a(f);return g};a.random=function(d,a){null==a&&(a=d,d=0);return d+Math.floor(Math.random()*
(a-d+1))};a.now=Date.now||function(){return(new Date).getTime()};t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};D=a.invert(t);G=function(d){var f=function(a){return d[a]},g="(?:"+a.keys(d).join("|")+")",c=RegExp(g),b=RegExp(g,"g");return function(d){d=null==d?"":""+d;return c.test(d)?d.replace(b,f):d}};a.escape=G(t);a.unescape=G(D);a.result=function(d,f,g){f=null==d?void 0:d[f];void 0===f&&(f=g);return a.isFunction(f)?f.call(d):f};var d=0;a.uniqueId=function(a){var f=
++d+"";return a?a+f:f};a.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var f=/(.)^/,g={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},P=/\\|'|\r|\n|\u2028|\u2029/g,Q=function(d){return"\\"+g[d]};a.template=function(d,g,c){!g&&c&&(g=c);g=a.defaults({},g,a.templateSettings);c=RegExp([(g.escape||f).source,(g.interpolate||f).source,(g.evaluate||f).source].join("|")+"|$","g");var b=0,e="__p+='";d.replace(c,function(a,f,g,
c,h){e+=d.slice(b,h).replace(P,Q);b=h+a.length;f?e+="'+\n((__t=("+f+"))==null?'':_.escape(__t))+\n'":g?e+="'+\n((__t=("+g+"))==null?'':__t)+\n'":c&&(e+="';\n"+c+"\n__p+='");return a});e+="';\n";g.variable||(e="with(obj||{}){\n"+e+"}\n");e="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+e+"return __p;\n";try{var h=new Function(g.variable||"obj","_",e)}catch(k){throw k.source=e,k;}c=function(d){return h.call(this,d,a)};c.source="function("+(g.variable||"obj")+
"){\n"+e+"}";return c};a.chain=function(d){d=a(d);d._chain=!0;return d};var O=function(d,f){return d._chain?a(f).chain():f};a.mixin=function(d){a.each(a.functions(d),function(f){var g=a[f]=d[f];a.prototype[f]=function(){var d=[this._wrapped];m.apply(d,arguments);return O(this,g.apply(a,d))}})};a.mixin(a);a.each("pop push reverse shift sort splice unshift".split(" "),function(d){var f=h[d];a.prototype[d]=function(){var a=this._wrapped;f.apply(a,arguments);"shift"!==d&&"splice"!==d||0!==a.length||delete a[0];
return O(this,a)}});a.each(["concat","join","slice"],function(d){var f=h[d];a.prototype[d]=function(){return O(this,f.apply(this._wrapped,arguments))}});a.prototype.value=function(){return this._wrapped};a.prototype.valueOf=a.prototype.toJSON=a.prototype.value;a.prototype.toString=function(){return""+this._wrapped};"function"===typeof define&&define.amd&&define("underscore",[],function(){return a})}).call(this);window._sv=_.noConflict();
(function(){var b=this,l=b.Backbone,n=[],q=n.push,e=n.slice,p=n.splice,h;h="undefined"!==typeof exports?exports:b.Backbone={};h.VERSION="1.0.0";var c=b._sv;c||"undefined"===typeof require||(c=require("underscore"));h.$=b.jQuery||b.Zepto||b.ender||b.$;h.noConflict=function(){b.Backbone=l;return this};h.emulateHTTP=!1;h.emulateJSON=!1;var m=h.Events={on:function(d,a,g){if(!k(this,"on",d,[a,g])||!a)return this;this._events||(this._events={});(this._events[d]||(this._events[d]=[])).push({callback:a,context:g,
ctx:g||this});return this},once:function(d,a,g){if(!k(this,"once",d,[a,g])||!a)return this;var b=this,e=c.once(function(){b.off(d,e);a.apply(this,arguments)});e._callback=a;return this.on(d,e,g)},off:function(d,a,g){var b,e,h,m,t,s,l,x;if(!this._events||!k(this,"off",d,[a,g]))return this;if(!d&&!a&&!g)return this._events={},this;m=d?[d]:c.keys(this._events);t=0;for(s=m.length;t<s;t++)if(d=m[t],h=this._events[d]){this._events[d]=b=[];if(a||g)for(l=0,x=h.length;l<x;l++)e=h[l],(a&&a!==e.callback&&a!==
e.callback._callback||g&&g!==e.context)&&b.push(e);b.length||delete this._events[d]}return this},trigger:function(d){if(!this._events)return this;var a=e.call(arguments,1);if(!k(this,"trigger",d,a))return this;var g=this._events[d],c=this._events.all;g&&s(g,a);c&&s(c,arguments);return this},stopListening:function(d,a,g){var c=this._listeners;if(!c)return this;var b=!a&&!g;"object"===typeof a&&(g=this);d&&((c={})[d._listenerId]=d);for(var e in c)c[e].off(a,g,this),b&&delete this._listeners[e];return this}},
u=/\s+/,k=function(d,a,g,c){if(!g)return!0;if("object"===typeof g){for(var b in g)d[a].apply(d,[b,g[b]].concat(c));return!1}if(u.test(g)){g=g.split(u);b=0;for(var e=g.length;b<e;b++)d[a].apply(d,[g[b]].concat(c));return!1}return!0},s=function(d,a){var g,c=-1,b=d.length,e=a[0],h=a[1],k=a[2];switch(a.length){case 0:for(;++c<b;)(g=d[c]).callback.call(g.ctx);break;case 1:for(;++c<b;)(g=d[c]).callback.call(g.ctx,e);break;case 2:for(;++c<b;)(g=d[c]).callback.call(g.ctx,e,h);break;case 3:for(;++c<b;)(g=
d[c]).callback.call(g.ctx,e,h,k);break;default:for(;++c<b;)(g=d[c]).callback.apply(g.ctx,a)}};c.each({listenTo:"on",listenToOnce:"once"},function(d,a){m[a]=function(a,f,b){var e=this._listeners||(this._listeners={}),h=a._listenerId||(a._listenerId=c.uniqueId("l"));e[h]=a;"object"===typeof f&&(b=this);a[d](f,b,this);return this}});m.bind=m.on;m.unbind=m.off;c.extend(h,m);var t=h.Model=function(d,a){var g,b=d||{};a||(a={});this.cid=c.uniqueId("c");this.attributes={};c.extend(this,c.pick(a,w));a.parse&&
(b=this.parse(b,a)||{});if(g=c.result(this,"defaults"))b=c.defaults({},b,g);this.set(b,a);this.changed={};this.initialize.apply(this,arguments)},w=["url","urlRoot","collection"];c.extend(t.prototype,m,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(d){return c.clone(this.attributes)},sync:function(){return h.sync.apply(this,arguments)},get:function(d){return this.attributes[d]},escape:function(d){return c.escape(this.get(d))},has:function(d){return null!=
this.get(d)},set:function(d,a,g){var b,e,h,k,m,t,s;if(null==d)return this;"object"===typeof d?(e=d,g=a):(e={})[d]=a;g||(g={});if(!this._validate(e,g))return!1;h=g.unset;k=g.silent;d=[];m=this._changing;this._changing=!0;m||(this._previousAttributes=c.clone(this.attributes),this.changed={});s=this.attributes;t=this._previousAttributes;this.idAttribute in e&&(this.id=e[this.idAttribute]);for(b in e)a=e[b],c.isEqual(s[b],a)||d.push(b),c.isEqual(t[b],a)?delete this.changed[b]:this.changed[b]=a,h?delete s[b]:
s[b]=a;if(!k)for(d.length&&(this._pending=!0),a=0,b=d.length;a<b;a++)this.trigger("change:"+d[a],this,s[d[a]],g);if(m)return this;if(!k)for(;this._pending;)this._pending=!1,this.trigger("change",this,g);this._changing=this._pending=!1;return this},unset:function(d,a){return this.set(d,void 0,c.extend({},a,{unset:!0}))},clear:function(d){var a={},g;for(g in this.attributes)a[g]=void 0;return this.set(a,c.extend({},d,{unset:!0}))},hasChanged:function(d){return null==d?!c.isEmpty(this.changed):c.has(this.changed,
d)},changedAttributes:function(d){if(!d)return this.hasChanged()?c.clone(this.changed):!1;var a,g=!1,b=this._changing?this._previousAttributes:this.attributes,e;for(e in d)c.isEqual(b[e],a=d[e])||((g||(g={}))[e]=a);return g},previous:function(d){return null!=d&&this._previousAttributes?this._previousAttributes[d]:null},previousAttributes:function(){return c.clone(this._previousAttributes)},fetch:function(d){d=d?c.clone(d):{};void 0===d.parse&&(d.parse=!0);var a=this,g=d.success;d.success=function(c){if(!a.set(a.parse(c,
d),d))return!1;g&&g(a,c,d);a.trigger("sync",a,c,d)};I(this,d);return this.sync("read",this,d)},save:function(d,a,g){var b,e=this.attributes;null==d||"object"===typeof d?(b=d,g=a):(b={})[d]=a;if(!(!b||g&&g.wait||this.set(b,g)))return!1;g=c.extend({validate:!0},g);if(!this._validate(b,g))return!1;b&&g.wait&&(this.attributes=c.extend({},e,b));void 0===g.parse&&(g.parse=!0);var h=this,k=g.success;g.success=function(d){h.attributes=e;var a=h.parse(d,g);g.wait&&(a=c.extend(b||{},a));if(c.isObject(a)&&!h.set(a,
g))return!1;k&&k(h,d,g);h.trigger("sync",h,d,g)};I(this,g);d=this.isNew()?"create":g.patch?"patch":"update";"patch"===d&&(g.attrs=b);d=this.sync(d,this,g);b&&g.wait&&(this.attributes=e);return d},destroy:function(d){d=d?c.clone(d):{};var a=this,g=d.success,b=function(){a.trigger("destroy",a,a.collection,d)};d.success=function(c){(d.wait||a.isNew())&&b();g&&g(a,c,d);a.isNew()||a.trigger("sync",a,c,d)};if(this.isNew())return d.success(),!1;I(this,d);var e=this.sync("delete",this,d);d.wait||b();return e},
url:function(){var d=c.result(this,"urlRoot")||c.result(this.collection,"url")||K();return this.isNew()?d:d+("/"===d.charAt(d.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(d,a){return d},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(d){return this._validate({},c.extend(d||{},{validate:!0}))},_validate:function(d,a){if(!a.validate||!this.validate)return!0;d=c.extend({},this.attributes,d);var g=this.validationError=
this.validate(d,a)||null;if(!g)return!0;this.trigger("invalid",this,g,c.extend(a||{},{validationError:g}));return!1}});c.each("keys values pairs invert pick omit".split(" "),function(d){t.prototype[d]=function(){var a=e.call(arguments);a.unshift(this.attributes);return c[d].apply(c,a)}});var z=h.Collection=function(d,a){a||(a={});a.url&&(this.url=a.url);a.model&&(this.model=a.model);void 0!==a.comparator&&(this.comparator=a.comparator);this._reset();this.initialize.apply(this,arguments);d&&this.reset(d,
c.extend({silent:!0},a))},B={add:!0,remove:!0,merge:!0},v={add:!0,merge:!1,remove:!1};c.extend(z.prototype,m,{model:t,initialize:function(){},toJSON:function(d){return this.map(function(a){return a.toJSON(d)})},sync:function(){return h.sync.apply(this,arguments)},add:function(d,a){return this.set(d,c.defaults(a||{},v))},remove:function(d,a){d=c.isArray(d)?d.slice():[d];a||(a={});var g,b,e,h;g=0;for(b=d.length;g<b;g++)if(h=this.get(d[g]))delete this._byId[h.id],delete this._byId[h.cid],e=this.indexOf(h),
this.models.splice(e,1),this.length--,a.silent||(a.index=e,h.trigger("remove",h,this,a)),this._removeReference(h);return this},set:function(d,a){a=c.defaults(a||{},B);a.parse&&(d=this.parse(d,a));c.isArray(d)||(d=d?[d]:[]);var g,b,e,h,k,m=a.at,t=this.comparator&&null==m&&!1!==a.sort,s=c.isString(this.comparator)?this.comparator:null,l=[],x=[],n={};g=0;for(b=d.length;g<b;g++)if(e=this._prepareModel(d[g],a))(h=this.get(e))?(a.remove&&(n[h.cid]=!0),a.merge&&(h.set(e.attributes,a),t&&!k&&h.hasChanged(s)&&
(k=!0))):a.add&&(l.push(e),e.on("all",this._onModelEvent,this),this._byId[e.cid]=e,null!=e.id&&(this._byId[e.id]=e));if(a.remove){g=0;for(b=this.length;g<b;++g)n[(e=this.models[g]).cid]||x.push(e);x.length&&this.remove(x,a)}l.length&&(t&&(k=!0),this.length+=l.length,null!=m?p.apply(this.models,[m,0].concat(l)):q.apply(this.models,l));k&&this.sort({silent:!0});if(a.silent)return this;g=0;for(b=l.length;g<b;g++)(e=l[g]).trigger("add",e,this,a);k&&this.trigger("sort",this,a);return this},reset:function(d,
a){a||(a={});for(var g=0,b=this.models.length;g<b;g++)this._removeReference(this.models[g]);a.previousModels=this.models;this._reset();this.add(d,c.extend({silent:!0},a));a.silent||this.trigger("reset",this,a);return this},push:function(a,f){a=this._prepareModel(a,f);this.add(a,c.extend({at:this.length},f));return a},pop:function(a){var f=this.at(this.length-1);this.remove(f,a);return f},unshift:function(a,f){a=this._prepareModel(a,f);this.add(a,c.extend({at:0},f));return a},shift:function(a){var f=
this.at(0);this.remove(f,a);return f},slice:function(a,f){return this.models.slice(a,f)},get:function(a){return null==a?void 0:this._byId[null!=a.id?a.id:a.cid||a]},at:function(a){return this.models[a]},where:function(a,f){return c.isEmpty(a)?f?void 0:[]:this[f?"find":"filter"](function(f){for(var c in a)if(a[c]!==f.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw Error("Cannot sort a set without a comparator");a||(a={});c.isString(this.comparator)||
1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(c.bind(this.comparator,this));a.silent||this.trigger("sort",this,a);return this},sortedIndex:function(a,f,g){f||(f=this.comparator);var b=c.isFunction(f)?f:function(a){return a.get(f)};return c.sortedIndex(this.models,a,b,g)},pluck:function(a){return c.invoke(this.models,"get",a)},fetch:function(a){a=a?c.clone(a):{};void 0===a.parse&&(a.parse=!0);var f=a.success,g=this;a.success=function(c){g[a.reset?"reset":
"set"](c,a);f&&f(g,c,a);g.trigger("sync",g,c,a)};I(this,a);return this.sync("read",this,a)},create:function(a,f){f=f?c.clone(f):{};if(!(a=this._prepareModel(a,f)))return!1;f.wait||this.add(a,f);var g=this,b=f.success;f.success=function(c){f.wait&&g.add(a,f);b&&b(a,c,f)};a.save(null,f);return a},parse:function(a,f){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(a,f){if(a instanceof t)return a.collection||
(a.collection=this),a;f||(f={});f.collection=this;var g=new this.model(a,f);return g._validate(a,f)?g:(this.trigger("invalid",this,a,f),!1)},_removeReference:function(a){this===a.collection&&delete a.collection;a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,f,g,c){if("add"!==a&&"remove"!==a||g===this)"destroy"===a&&this.remove(f,c),f&&a==="change:"+f.idAttribute&&(delete this._byId[f.previous(f.idAttribute)],null!=f.id&&(this._byId[f.id]=f)),this.trigger.apply(this,arguments)}});c.each("forEach each map collect reduce foldl inject reduceRight foldr find detect filter select reject every all some any include contains invoke max min toArray size first head take initial rest tail drop last without indexOf shuffle lastIndexOf isEmpty chain".split(" "),
function(a){z.prototype[a]=function(){var f=e.call(arguments);f.unshift(this.models);return c[a].apply(c,f)}});c.each(["groupBy","countBy","sortBy"],function(a){z.prototype[a]=function(f,g){var b=c.isFunction(f)?f:function(a){return a.get(f)};return c[a](this.models,b,g)}});var n=h.View=function(a){this.cid=c.uniqueId("view");this._configure(a||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()},a=/^(\S+)\s*(.*)$/,x="model collection el id attributes className tagName events".split(" ");
c.extend(n.prototype,m,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(a,f){this.$el&&this.undelegateEvents();this.$el=a instanceof h.$?a:h.$(a);this.el=this.$el[0];!1!==f&&this.delegateEvents();return this},delegateEvents:function(d){if(!d&&!(d=c.result(this,"events")))return this;this.undelegateEvents();for(var f in d){var g=d[f];c.isFunction(g)||
(g=this[d[f]]);if(g){var b=f.match(a),e=b[1],b=b[2],g=c.bind(g,this),e=e+(".delegateEvents"+this.cid);if(""===b)this.$el.on(e,g);else this.$el.on(e,b,g)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_configure:function(a){this.options&&(a=c.extend({},c.result(this,"options"),a));c.extend(this,c.pick(a,x));this.options=a},_ensureElement:function(){if(this.el)this.setElement(c.result(this,"el"),!1);else{var a=c.extend({},c.result(this,"attributes"));
this.id&&(a.id=c.result(this,"id"));this.className&&(a["class"]=c.result(this,"className"));a=h.$("<"+c.result(this,"tagName")+">").attr(a);this.setElement(a,!1)}}});h.sync=function(a,f,g){var b=A[a];c.defaults(g||(g={}),{emulateHTTP:h.emulateHTTP,emulateJSON:h.emulateJSON});var e={type:b,dataType:"json"};g.url||(e.url=c.result(f,"url")||K());null!=g.data||!f||"create"!==a&&"update"!==a&&"patch"!==a||(e.contentType="application/json",e.data=JSON.stringify(g.attrs||f.toJSON(g)));g.emulateJSON&&(e.contentType=
"application/x-www-form-urlencoded",e.data=e.data?{model:e.data}:{});if(g.emulateHTTP&&("PUT"===b||"DELETE"===b||"PATCH"===b)){e.type="POST";g.emulateJSON&&(e.data._method=b);var k=g.beforeSend;g.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",b);if(k)return k.apply(this,arguments)}}"GET"===e.type||g.emulateJSON||(e.processData=!1);"PATCH"!==e.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(e.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});
a=g.xhr=h.ajax(c.extend(e,g));f.trigger("request",f,a,g);return a};var A={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};h.ajax=function(){return h.$.ajax.apply(h.$,arguments)};var D=h.Router=function(a){a||(a={});a.routes&&(this.routes=a.routes);this._bindRoutes();this.initialize.apply(this,arguments)},F=/\((.*?)\)/g,G=/(\(\?)?:\w+/g,N=/\*\w+/g,E=/[\-{}\[\]+?.,\\\^$|#\s]/g;c.extend(D.prototype,m,{initialize:function(){},route:function(a,f,g){c.isRegExp(a)||(a=this._routeToRegExp(a));
c.isFunction(f)&&(g=f,f="");g||(g=this[f]);var b=this;h.history.route(a,function(c){c=b._extractParameters(a,c);g&&g.apply(b,c);b.trigger.apply(b,["route:"+f].concat(c));b.trigger("route",f,c);h.history.trigger("route",b,f,c)});return this},navigate:function(a,f){h.history.navigate(a,f);return this},_bindRoutes:function(){if(this.routes){this.routes=c.result(this,"routes");for(var a,f=c.keys(this.routes);null!=(a=f.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){a=a.replace(E,"\\$&").replace(F,
"(?:$1)?").replace(G,function(a,d){return d?a:"([^/]+)"}).replace(N,"(.*?)");return new RegExp("^"+a+"$")},_extractParameters:function(a,f){var b=a.exec(f).slice(1);return c.map(b,function(a){return a?decodeURIComponent(a):null})}});var y=h.History=function(){this.handlers=[];c.bindAll(this,"checkUrl");"undefined"!==typeof window&&(this.location=window.location,this.history=window.history)},J=/^[#\/]|\s+$/g,H=/^\/+|\/+$/g,L=/msie [\w.]+/,M=/\/$/;y.started=!1;c.extend(y.prototype,m,{interval:50,getHash:function(a){return(a=
(a||this).location.href.match(/#(.*)$/))?a[1]:""},getFragment:function(a,f){if(null==a)if(this._hasPushState||!this._wantsHashChange||f){a=this.location.pathname;var b=this.root.replace(M,"");a.indexOf(b)||(a=a.substr(b.length))}else a=this.getHash();return a.replace(J,"")},start:function(a){if(y.started)throw Error("Backbone.history has already been started");y.started=!0;this.options=c.extend({},{root:"/"},this.options,a);this.root=this.options.root;this._wantsHashChange=!1!==this.options.hashChange;
this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);a=this.getFragment();var f=document.documentMode,f=L.exec(navigator.userAgent.toLowerCase())&&(!f||7>=f);this.root=("/"+this.root+"/").replace(H,"/");f&&this._wantsHashChange&&(this.iframe=h.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(a));if(this._hasPushState)h.$(window).on("popstate",this.checkUrl);else if(this._wantsHashChange&&
"onhashchange"in window&&!f)h.$(window).on("hashchange",this.checkUrl);else this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval));this.fragment=a;a=this.location;f=a.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!f)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&f&&a.hash&&(this.fragment=
this.getHash().replace(J,""),this.history.replaceState({},document.title,this.root+this.fragment+a.search));if(!this.options.silent)return this.loadUrl()},stop:function(){h.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);y.started=!1},route:function(a,f){this.handlers.unshift({route:a,callback:f})},checkUrl:function(a){a=this.getFragment();a===this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe)));if(a===this.fragment)return!1;
this.iframe&&this.navigate(a);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(a){var f=this.fragment=this.getFragment(a);return c.any(this.handlers,function(a){if(a.route.test(f))return a.callback(f),!0})},navigate:function(a,f){if(!y.started)return!1;f&&!0!==f||(f={trigger:f});a=this.getFragment(a||"");if(this.fragment!==a){this.fragment=a;var b=this.root+a;if(this._hasPushState)this.history[f.replace?"replaceState":"pushState"]({},document.title,b);else if(this._wantsHashChange)this._updateHash(this.location,
a,f.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(f.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,f.replace));else return this.location.assign(b);f.trigger&&this.loadUrl(a)}},_updateHash:function(a,b,c){c?(c=a.href.replace(/(javascript:|#).*$/,""),a.replace(c+"#"+b)):a.hash="#"+b}});h.history=new y;t.extend=z.extend=D.extend=n.extend=y.extend=function(a,b){var g=this,e;e=a&&c.has(a,"constructor")?a.constructor:function(){return g.apply(this,
arguments)};c.extend(e,g,b);var h=function(){this.constructor=e};h.prototype=g.prototype;e.prototype=new h;a&&c.extend(e.prototype,a);e.__super__=g.prototype;return e};var K=function(){throw Error('A "url" property or function must be specified');},I=function(a,b){var c=b.error;b.error=function(e){c&&c(a,e,b);a.trigger("error",a,e,b)}}}).call(this);window.SVBackbone=Backbone.noConflict();SVBackbone.$=$svjq;
(function(){function b(b,c,e){var l=window.sv.ErrorUtil;l&&l.handleBackboneError(b,c,e)}var l=window.SVBackbone,n=l.Model.prototype.fetch,q=l.Model.prototype.save,e=l.Model.prototype.destroy,p=l.Collection.prototype.fetch;l.Model.prototype.fetch=function(e){e=e||{};e.error=e.error||b;return n.apply(this,[e])};l.Model.prototype.save=function(e,c,m){null==e||"object"===typeof e?(c=c||{},c.error=c.error||b):(m=m||{},m.error=m.error||b);return q.apply(this,[e,c,m])};l.Model.prototype.destroy=function(h){h=
h||{};h.error=h.error||b;return e.apply(this,[h])};l.Collection.prototype.fetch=function(e){e=e||{};e.error=e.error||b;return p.apply(this,[e])}})();
(function(){var b=window.sv,l=b.ObjectUtil,n=b.Log,q=window.$svjq,e=window._sv,p=function(b){return(b=(new RegExp("[\\?&]"+b+"=([^&#]*)")).exec(window.location.href))?b[1]:null},h=function(b,c,e){var h;h="string"===q.type(b)?q(b):b;q.get(c,function(b){h.fadeOut("fast",function(){h.html(b);h.fadeIn();q.isFunction(e)&&e.call(this)})})},c={};b.PortletUtil={getModelObjectUri:function(c,e,h){c="/modelobjectapi/1/"+b.PageContext.pageId+"/"+c+"/"+e;h&&(c+="/"+h);return c},getEditApiUri:function(c){var e=
c.modelHandler,h=c.objectId,s=c.operationObjectId,t=c.contextNodeId||b.PageContext.pageId;"string"===typeof c&&(e=c);h||(h=b.PageContext.pageId);c="/edit-api/1/"+t+"/"+h+"/"+e;s&&(c+="/"+s);return c},getPortletUri:function(c,e){return"/"+b.PageContext.pageId+"/"+c+".xml?state="+e},getPortletResourceUri:function(c,e){var h=p("identity"),s=p("group"),t=p("tag");return"/portletresource/"+b.PageContext.pageId+"/"+c+"?state="+e+(h?"&identity="+h:"")+(s?"&group="+s:"")+(t?"&tag="+t:"")},reloadPortletsByType:function(c,
e){var k=q(c);q.each(k,function(){var c=q(this),k=c.attr("id"),k=l.getObjectId(k);h(c,"/"+b.PageContext.pageId+"/"+k+".xml"+(e||""))})},doGetWithFade:h,doGet:function(b,c){q.get(c,function(c){q(b).html(c)})},getTemplate:function(b,h){var k=b.attr("id"),l;if(k){k=k.replace(".","_");if(!c[k+h]){l=b.find("script.sv-tmpl-"+h);if(0===l.length){n.warn("portletUtil","Could not find template with name "+h+" for portlet "+k);return}c[k+h]=e.template(l.html())}return c[k+h]}n.warn("portletUtil","Tried to get template from invalid element")}}})();
(function(){var b=window.$svjq,l=window.sv,n=l.KeyUtil,q=l.DialogUtil,e=l.PortletUtil,p=l.DateUtil,h=l.Events,c=window.moment,m=window.SVBackbone,u=b("html").hasClass("sv-touch"),k=function(a,b){return l.i18n.getText("common",a,b)},s,t=m.View.extend({template:function(){return e.getTemplate(this.options.$portlet,this.templateName)},memberTemplate:function(){return e.getTemplate(this.options.$portlet,this.memberTemplateName)},participantTemplate:function(){return e.getTemplate(this.options.$portlet,
this.participantTemplateName)},events:{"click [data-fn-allday]":"toggleTimeVisibility",'keyup [name="where"]':"showMapLink"},initialize:function(a){this.options=a;this.originalValues={};a=this.template();var c=b.extend(this.model.toJSON(),this.templateHelpers);this.$el.append(a(c));this.listenTo(this.model,"invalid",this.handleErrors);this.ui={startDate:this.$el.find("[name=startDate]"),startTime:this.$el.find("[data-fn-time-value-start]"),endDate:this.$el.find("[name=endDate]"),endTime:this.$el.find("[data-fn-time-value-end]"),
allDay:this.$el.find("[name=allDay]"),isDone:this.$el.find("[name=isDone]"),owner:this.$el.find("#owner"),participants:this.$el.find("#participants")}},render:function(){var a=this,h=[{text:k("cancel"),callback:function(){b(".modal").modal("hide");a.restoreChanges()}}];this.model.isNew()?h.push({text:this.i18n("create"),skipDismiss:!0,primary:!0,callback:function(){a.saveChanges()}}):h.push({text:k("remove"),danger:!0,callback:b.proxy(this.removeActivity,this)},{text:k("ok"),skipDismiss:!0,primary:!0,
callback:function(){a.saveChanges()}});q.showDialog({title:this.model.attributes.isTask?this.i18n("task"):this.i18n("event"),body:this.$el,buttons:h,removeOnHide:!0,errorTitle:k("networkErrorTitle"),errorMsg:k("networkErrorText")});h={format:c.langData()._longDateFormat.L.toLowerCase(),autoclose:!0};this.ui.startDate.bootstrapDatepicker(h).on("change",b.proxy(function(){var a=this.ui.endDate.val(),b=this.ui.startDate.bootstrapDatepicker("getDate");!a&&b&&this.ui.endDate.bootstrapDatepicker("setDate",
b)},this));this.ui.endDate.bootstrapDatepicker(h);var h=this.$el.parent().parent(),t={decimal:k("decimal"),mins:k("mins"),hr:k("hr"),hrs:k("hrs")},l=p.moment2PhpFormat(c.langData()._longDateFormat.LT);this.ui.startTime.timepicker({timeFormat:l,lang:t,appendTo:h,scrollDefaultNow:!0}).on("timeFormatError",b.proxy(function(){var a=c();this.ui.startTime.val(a.format("LT"))},this)).on("change",b.proxy(function(){var a;!this.ui.endTime.val()&&this.ui.startTime.val()&&(a=c(this.ui.startTime.val(),"LT",!0),
a.add("hours",2),this.ui.endTime.val(a.format("LT")))},this));this.ui.endTime.timepicker({timeFormat:l,lang:t,appendTo:h}).on("timeFormatError",b.proxy(function(){var a=this.ui.startTime.val();a?(a=c(a,"LT",!0),a.add("hours",2)):a=c();this.ui.endTime.val(a.format("LT"))},this));b.ajax({url:e.getPortletResourceUri(this.options.portletId,this.membersWithOwnerActionName)+(this.model.isNew()?"":"&id="+this.model.id)}).done(b.proxy(function(a){this.ui.owner.select2({allowClear:!0,data:a,formatResult:this.memberTemplate(),
escapeMarkup:function(a){return a}})},this));b.ajax({url:e.getPortletResourceUri(this.options.portletId,this.membersActionName)}).done(b.proxy(function(a){this.ui.participants.select2({multiple:!0,data:a,formatResult:this.memberTemplate(),formatSelection:this.participantTemplate(),escapeMarkup:function(a){return a}})},this))},handleErrors:function(a,b){z(a,b,this.$el,this.i18n)},templateHelpers:{mapUrl:function(a){return v(a)},datePickerValue:function(a){return c(a).isValid()?c(a).format("L"):""},
timePickerValue:function(a){return c(a).isValid()?"00:00"===c(a).format("LT")||"12:00 AM"===c(a).format("LT")?"":c(a).format("LT"):""}},showMapLink:function(a){this.typingTimer&&window.clearTimeout(this.typingTimer);this.typingTimer=window.setTimeout(b.proxy(function(){var c=v(a.currentTarget.value);if(!this.$mapLink&&(this.$mapLink=this.$el.find("[data-fn-map-link]"),!this.$mapLink.length)){var e='<span class="help-block"><i class="halflings-icon icon-map-marker"></i> <a data-fn-map-link class="sv-map-link" target="_blank" href="'+
c+'">'+this.i18n("map")+"</a></span>";this.$mapLink=b(e).insertAfter(a.currentTarget).find("[data-fn-map-link]")}a.currentTarget.value?this.$mapLink.closest(".help-block").show():this.$mapLink.closest(".help-block").hide();this.$mapLink.attr("href",c)},this),1E3)},toggleTimeVisibility:function(){this.ui.startTime.toggleClass("sv-hidden");this.ui.endTime.toggleClass("sv-hidden")},setAndSaveForRestore:function(a,b){this.originalValues[a]||(this.originalValues[a]=this.model.get(a));this.model.set(a,
b)},restoreChanges:function(){var a=this;b.each(this.originalValues,function(b,c){a.model.set(b,c)})},setAndSaveDateForRestore:function(a,b,e){b.length?(b=c(b,"L",!0),e=c(e,"LT",!0),b.hours(e.hours()).minutes(e.minutes()),this.setAndSaveForRestore(a,b.valueOf())):this.setAndSaveForRestore(a,"")},saveChanges:function(){var a=this;this.$el.find("[data-fn-standard-value]").each(function(){a.setAndSaveForRestore(this.name,b.trim(this.value))});var c=this.ui.allDay.prop("checked");this.setAndSaveForRestore("allDay",
c);var c=b.trim(this.ui.startDate.val()),e=b.trim(this.ui.startTime.val());this.setAndSaveDateForRestore("start",c,e);c=b.trim(this.ui.endDate.val());e=b.trim(this.ui.endTime.val());this.setAndSaveDateForRestore("end",c,e);c=this.ui.isDone.prop("checked");this.setAndSaveForRestore("isDone",c);var k=this.model.isNew();this.model.save(null,{wait:!0,success:function(c){a.backingModel.set(c.attributes);b(".modal").modal("hide");k?h.trigger(h.types.activityCreated,c.attributes):h.trigger(h.types.activityUpdated,
c.attributes)},error:function(){b(".alert").show()}})}}),w=m.View.extend({template:function(){return e.getTemplate(this.options.$portlet,this.templateName)},events:{"click [data-fn-more]":"more","click [data-fn-remove]":"removeActivity","click [data-fn-edit]":"editActivity","mouseenter [data-participants]":"showParticipants","mouseleave [data-participants]":"hideParticipants"},initialize:function(a){this.options=a;a=this.template();var c=b.extend(this.model.toJSON(),this.templateHelpers());s=this.options.i18n;
this.$el.append(a(c));s=null;this.ui={description:this.$el.find("[data-fn-description]"),more:this.$el.find("[data-fn-more-remainder]"),participants:this.$el.find("[data-participants]")}},render:function(){var a=b("<div/>").text(this.model.get("title")).html(),c=B(this.options.$target);h.trigger(h.types.popoverCreated,this);this.options.$target.popover({html:!0,title:'<button type="button" class="close">&times;</button>'+a,placement:c,content:this.el,trigger:"manual",container:this.options.popoverContainer}).popover("show");
a=this.$el.closest(".popover");if(this.options.jsEvent){var e=this.options.jsEvent.pageY;if("top"===c)e-=a.height()+10;else if("left"===c||"right"===c)e-=a.height()/2;a.css({top:e})}a.on("click",".close",b.proxy(this.closePopover,this)).on("clickoutside",b.proxy(this.closePopover,this));b(document).on("keydown",b.proxy(this.closePopoverOnEscape,this));b("[data-fn-request-focus]").focus();h.on(h.types.popoverCreated,b.proxy(this.closePopoverWhenOtherIsCreated,this));return this},templateHelpers:function(){var a=
{maxSizeText:function(a){a=b("<div/>").text(a).html();if(150>a.length)return a;var c="<span>"+a.substring(0,150)+'</span><span data-fn-more class="sv-more">&nbsp;...'+s("more")+" &raquo;</span>";return c+='<span data-fn-more-remainder class="sv-hidden">'+a.substring(150)+"</span>"},mapUrl:function(a){return v(a)}};this.templateHelpers2&&(a=b.extend(a,this.templateHelpers2));return a},showParticipants:function(){var a=this.model.get("participants");a&&0<a.length&&(this.participants?this.showParticipantsTooltip():
b.ajax({url:e.getPortletResourceUri(this.options.portletId,this.participantsActionName)+"&id="+this.model.id}).done(b.proxy(function(a){this.participants=a;this.showParticipantsTooltip()},this)))},showParticipantsTooltip:function(){this.ui.participants.tooltip({html:!0,title:this.participants.join("<br/>")});this.ui.participants.tooltip("show")},hideParticipants:function(){this.ui.participants.tooltip("destroy")},more:function(a){b(a.currentTarget).addClass("sv-hidden");this.ui.description.css("max-height",
this.ui.description.height()+20+"px").addClass("sv-show-scroll");this.ui.more.removeClass("sv-hidden")},closePopover:function(){h.off(h.types.popoverCreated);b(document).off("keydown",this.closePopoverOnEscape);this.$el.closest(".popover").off("click",".close",this.closePopover).off("clickoutside",this.closePopover).remove();this.options.$target.popover("destroy")},editActivity:function(){this.model.fetch({success:b.proxy(function(a){this.createEditView(a).render();u&&b(window).scrollTop(0)},this)});
this.closePopover();return!1},closePopoverWhenOtherIsCreated:function(a){this!==a&&this.closePopover()},closePopoverOnEscape:function(a){if(a.keyCode===n.KEY.ESC)return this.closePopover(),!1}}),m=m.Model.extend({defaults:{title:"",description:"",where:"",owner:"",participants:"",start:"",end:""},initialize:function(a,c){this.portletId=c.portletId},validate:function(a){var b=[];a.title||b.push({field:"title",message:"noTitle"});a.owner||b.push({field:"owner",message:"noOwner"});if(!this.allowEmptyStart&&
!a.start)b.push({field:"start",message:"noStart"});else if(a.allDay||a.end)a.start||b.push({field:"start",message:"noStart"});if(a.start&&a.end){var e=c(a.start),h=c(a.end);a.allDay&&h.isSame(e)||h.isAfter(e)||b.push({field:"end",message:a.allDay?"invalidAllDayTimePeriod":"invalidTimePeriod"})}!a.allDay&&a.start&&(a.end||b.push({field:"end",message:"noEnd"}));return b.length?b:void 0}}),z=function(a,c,b,e){a=0;var h=c.length,k;for(b.find(".control-group").removeClass("error").find(".help-block.error").remove();a<
h;a++)k=c[a],b.find('[name="'+k.field+'"]').closest(".control-group").addClass("error").find(".controls").append('<span class="help-block error">'+e(k.message)+"</span>")},B=function(a){if(u)return"bottom";var c=a.offset().top-b(window).scrollTop(),e=window.innerHeight-c;a=a.offset().left-b(window).scrollLeft();return 220<=e?"bottom":220<=c?"top":a>=window.innerWidth-a?"left":"right"},v=function(a){return"https://maps.google.se/maps?hl="+l.PageContext.userLocale+"&q="+a+"&source=calendar"};c.lang(l.PageContext.userLocale);
l.ActivityUtil={showErrors:z,calculatePopoverPlacement:B,stripYear:function(a,b){var e=""+c(a).year();return b.replace(new RegExp(e,"g"),"").replace(/  /g," ")},ActivityModel:m,ActivityDetailView:w,ActivityEditView:t}})();
(function(){function b(c){for(var b=0,e=c.length,h=[],k;b<e;b++)k=c[b],h.push({key:k,value:u(k)});return h}function l(c){c.groupTypes=b(c.groupTypes);var e=n(s(c)),h=[{text:q.i18n.getText("common","cancel")},{text:q.i18n.getText("common","ok"),skipDismiss:!0,primary:!0,callback:function(){var b=q.PortletUtil.getPortletResourceUri(c.portletId,"groupAdministration");n.ajax({type:"POST",dataType:"JSON",data:n(".sv-fn-create-group-form").serialize(),url:b,success:function(c){n(".modal").modal("hide");
location.href=c.showGroupURL},error:function(c){n(".alert").show();c=n.parseJSON(c.responseText);var a=n(".alert").find(".alert-title");a.data("orginal-title",a.text());a=n(".alert").find(".alert-message");a.data("orginal-message",a.text());a.text(u(c.type.toLowerCase()));e.find("input").first().focus().closest(".control-group").addClass("error")}})}}];q.DialogUtil.showDialog({title:u("createGroupLabel"),body:e,buttons:h,removeOnHide:!0,errorTitle:u("createGroupError"),errorMsg:u("groupAlreadyExists")})}
var n=window.$svjq,q=window.sv,e=q.KeyUtil,p=e.KEY,h={},c,m=window._sv,u=function(c,b){var e;if(!b&&h[c])return h[c];e=q.i18n.getText("portlet.util.addgrouputil",c,b);b||(h[c]=e);return e},k={success:function(){},selected:function(){},placeholder:"",groupTemplates:[],groupFolder:null,hitTemplate:m.template('<li data-group-id="<%= id %>" class="sv-clearfix <% if (isMember) { %> sv-group-member<% } %>">   <img class="sv-group-img sv-buddy-icon" src="<%= iconURL %>" />   <% if (isMember) { %><div style="float:right"><i class="halflings-icon ok"></i></div><% } %>   <div class="sv-group-info-container">     <h3 class="sv-group-name"><%- name %></h3>     <p>        <%= memberCount %> medlemmar     </p>   </div></li>')},
s=m.template('<form class="form-horizontal sv-fn-create-group-form">    <div class="control-group">       <label class="control-label">'+u("name")+'</label>       <div class="controls">          <input class="input-xlarge" data-fn-groupname type="text" name="name" required value="<%= name %>" />          <span class="help-block help">'+u("nameHelp")+'</span>       </div>    </div>    <div class="control-group">       <label class="control-label">'+u("description")+'</label>       <div class="controls">          <textarea class="input-xlarge" data-fn-groupdescription data-fn-request-focus rows="3" type="text" name="description"></textarea>          <span class="help-block help">'+
u("descriptionHelp")+'</span>       </div>    </div>    <% if (templates.length > 1) { %>    <div class="control-group">       <label class="control-label">'+u("template")+'</label>       <div class="controls">          <select name="template">            <% for(var idx in templates) { %>               <option value="<%= templates[idx].id %>"><%= templates[idx].name %></option>            <% } %>          </select>          <span class="help-block help">'+u("templateHelp")+'</span>       </div>    </div>    <% } else { %>    <input type="hidden" name="template" value="<%= templates[0].id %>">    <% } %>    <div class="control-group">       <label class="control-label">'+
u("type")+'</label>       <div class="controls">          <select name="type">            <% for(var idx in groupTypes) { %>               <option value="<%= groupTypes[idx].key %>"><%= groupTypes[idx].value %></option>            <% } %>          </select>          <span class="help-block help">'+u("typeHelp")+"</span>       </div>    </div> </form>");q.AddGroupUtil={showSearchPopover:function(b){var h=n.extend({},k,b),m=n(h.target),s=0;if(m.hasClass("sv-fn-popover-showing"))m.popover("destroy").removeClass("sv-fn-popover-showing");
else{b='<form class="form-search" onsubmit="return false;"><input type="text" placeholder="'+(h.placeholder||"")+'" data-fn-group-search class="span2 search-query"/></form>';h.groupFolder&&(b='<form class="form-search" onsubmit="return false;"><div class="input-append"><input type="text" placeholder="'+(h.placeholder||"")+'" data-fn-group-search class="span1 search-query"/><button type="button" class="btn btn-small sv-fn-create-group">'+u("createGroup")+"</button></div></form>");m.popover("destroy").addClass("sv-fn-popover-showing").popover({html:!0,
title:b,placement:"bottom",content:'<ul class="sv-group-search-list sv-defaultlist"></ul>',trigger:"manual"});m.popover("show");var v=function(a){n(a.target).is(".popover *")||(m.popover("destroy").removeClass("sv-fn-popover-showing"),n("body").unbind("click",v))};n("body").bind("click",v);m.parent().find("[data-fn-group-search]").focus().closest(".popover").addClass("sv-groupsearch-popover");m.parent().find(".popover").on("click",".sv-fn-create-group",function(){l({name:m.parent().find("[data-fn-group-search]").val(),
folder:h.groupFolder,templates:h.groupTemplates,groupTypes:h.groupTypes,portletId:h.portletId})});var a=m.parent().find(".popover-content").find("ul"),x=[];m.parent().find("[data-fn-group-search]").keydown(function(c){c=e.getKeyCodeFromEvent(c);if(c===p.DOWN)return s++,s>x.length-1&&(s=0),a.children().removeClass("active").eq(s).addClass("active"),!1;if(c===p.UP)return s--,0>s&&(s=x.length-1),a.children().removeClass("active").eq(s).addClass("active"),!1}).keyup(function(b){b=e.getKeyCodeFromEvent(b);
if(b===p.ESC)return m.popover("destroy"),!1;if(b===p.RETURN){if("undefined"!==typeof x[s])return m.popover("destroy"),h.selected&&h.selected.call(this,x[s]),!1;-1===s&&l({name:n(this).val(),folder:h.groupFolder,template:h.groupTemplate,groupTypes:h.groupTypes,portletId:h.portletId})}else{if(e.isNonTextModifiableKeyCode(b))return!1;var k=this;c&&clearTimeout(c);c=setTimeout(function(){s=-1;a.empty();var c=n(k).val();n.ajax({url:q.PortletUtil.getModelObjectUri(q.PageContext.pageId,"groupSearch",q.PageContext.pageId),
data:{term:c},dataType:"json"}).done(function(c){c.queryString===n(k).val()&&(s=0,a.empty(),x=c.hits,n.each(x,function(c,b){var e=n(h.hitTemplate(b));a.append(e);e.click(function(){m.popover("destroy");h.selected&&h.selected.call(this,b);return!1}).mouseenter(function(){a.children().removeClass("active");s=c;n(this).addClass("active")})}),h.success&&h.success.call(this,x))})},200)}})}}}})();
window.$svjq(function(){function b(b){c=window.setTimeout(function(){if(p&&0<m.length){var b=m[m.length-1];m=["0"];n.ajax({method:"PUT",url:"/modelobjectapi/1/"+e.pageId+"/"+e.pageId+"/groupViewed/"+e.pageId,data:JSON.stringify({uuid:b})}).success(function(){q.trigger(q.types.groupPageViewed)}).fail(function(c){switch(c.status){case 401:case 403:p=!1}})}c=void 0},b||h)}var l=window.sv,n=window.$svjq,q=l.Events,e=l.PageContext,p=!0,h=1E3*e.userIdentityReadTimeout,c,m=["0"];e&&e.pageId&&e.pageId.match("^704\\.")&&
(b(),q.on("server-group-updated-"+e.pageId,function(e){m.push(e.uuid);c?window.setTimeout(function(){window.clearTimeout(c);b(h/2)},h/2):b()}))});
(function(){var b=window.$svjq,l=window.sv,n=l.Log,q=l.Events,e=window._sv.template('<i class="halflings-icon thumbs-up"></i><b><%= likeText %></b> (<%= likeCount %>)'),p={},h=function(c){return p[c]?p[c]:l.i18n.getText("portlet.util.likableutil",c)},c=function(c){var b=c.data("like-count")||0,k=!!c.data("user-likes");c.html(e({likeText:k?h("likes"):h("like"),likeCount:b,userLikes:k}));c[k?"addClass":"removeClass"]("sv-liked")},m=function(e){e=e||b("body");e.is("[data-fn-likable],[data-fn-portlet-likable]")?
c(e):e.find("[data-fn-likable],[data-fn-portlet-likable]").each(function(){c(b(this))})},u=function(c,b){c.tooltip({html:!0,title:b.join("<br/>")});c.tooltip("show")},k=function(){var e=b(this),h=!!e.data("user-likes"),k=e.data("likable-id"),m;e.removeData("likes");e.tooltip("destroy");if(!k)n.warn("Trying to like object without likable-id in portlet "+e.closest(".sv-portlet").attr("id"));else if(!e.hasClass("sv-disabled"))return e.addClass("sv-disabled"),m=e.closest(".sv-portlet"),m=l.ObjectUtil.getObjectId(m.attr("id")),
m=h?l.PortletUtil.getPortletResourceUri(m,"unlike")+"&likable="+k:l.PortletUtil.getPortletResourceUri(m,"like"),b.ajax({url:m,method:h?"DELETE":"POST",dataType:"JSON",data:{likable:k}}).done(function(b){e.data("user-likes",!h).data("like-count",b.count);c(e)}).fail(function(c){l.ErrorUtil.handleAjaxFailure(c)}).always(function(){e.removeClass("sv-disabled")}),!1};l.LikableUtil={toggleLike:k};b("body").on("click.likeable","a[data-fn-likable]",k);b(document).on("mouseenter",".sv-like",function(){var c=
b(this),e=c.closest(".sv-portlet"),e=l.ObjectUtil.getObjectId(e.attr("id")),h=c.data("likable-id"),k=c.data("likes");0<c.data("like-count")&&(k?u(c,k):(e=l.PortletUtil.getPortletResourceUri(e,"likes")+"&likable="+h,b.ajax({url:e,method:"GET",dataType:"JSON"}).done(function(b){c.data("likes",b);u(c,b)}).fail(function(c){l.ErrorUtil.handleAjaxFailure(c)})))});b(document).on("mouseleave",".sv-like",function(){b(this).tooltip("destroy")});q.on(q.types.updateLikables,m);m()})();
(function(){var b=window.sv,l=window.$svjq,n=b.Events,q={includeHandle:!1,ajaxOptions:{timeout:5E3}},e=function(b){return/wikipedia.org|facebook.com\/groups/.test(b)};n.on(n.types.updateOembedLinks,function(n,h){function c(c){var b=document.createElement("a");b.href=c;c=b.hostname.split(".");b=c.length;c=1<b?c[b-2]:void 0;return c&&-1<u.indexOf(c)}function m(b,e){var h,k;if("IFRAME"===b.prop("tagName")&&c(b[0].src))return l('<div class="sv-iframeEmbed-16_9" />').append(b);if(b.find("iframe").length&&
c(b.find("iframe")[0].src))return b.find("iframe").wrap('<div class="sv-iframeEmbed-16_9" />'),b;if(b.hasClass("fb-post"))return b.attr("data-width","auto"),b;h=b.find("embed");if(h.length&&c(h[0].src)){k=h[0].src;var m=e&&e["twitter:player:stream"];if(m)return l("<video />",{src:m,controls:!0}).append(h);k=k.replace(/autoPlay=true/ig,"autoPlay=false").replace(/autostart=yes/ig,"autostart=no");0>k.indexOf("autostart")&&0>k.indexOf("autoPlay")&&(k=k+(0<k.indexOf("?")?"&":"?")+"autoPlay=false&autoplay=false&autostart=no");
h.attr("src",k).wrap('<div class="sv-iframeEmbed-16_9" />');return b}}if(n&&n.length&&(!n.hasClass("sv-embedded")||n.hasClass("sv-embeddedmedia-portlet"))){var u=["youtube","vimeo","wistia","bambuser","streamio"],k=n.find("a.sv-embed").first();if(k.length&&!e(k.attr("href"))){q.onEmbed=function(c){if(c&&c.code){var b=c.code;if("string"===typeof b)try{b=l(b)}catch(e){return}if(b instanceof l){var h=m(b,c.meta),b=(c=!!h)?h:b;if(1!==b.length||!b.is(":empty")){var h=this.closest(".sv-message-content"),
h=0<h.length?h.first():this.parent(),k=l("<a>",{href:this.attr("href"),target:"_blank"}),a=!c;c=l(c?'<div class="oembedall-container no-max-height"></div>':'<div class="oembedall-container"></div>');b.find("p").each(function(){var a=l(this),c=a.text();c&&200<c.length&&a.text(c.substring(0,190)+"...")});try{a?b.clone().wrap(k).parent().appendTo(c):b.clone().appendTo(c)}catch(n){a?c.append(b.wrap(k).parent()):c.append(b)}q.replace?this.replaceWith(c):h.after(c)}}}};q=l.extend(q,h);try{k.oembed(null,
q),n.addClass("sv-embedded")}catch(s){b.Log.error("oembedutil","Could not embed link. Error: "+s.message)}}}})})();(function(){var b=window.$svjq,l=window.moment,n=window.sv.Events,q=b("html").attr("lang")||"en",e=function(e){e=e||b("body");e.find("time[data-fn-relative-date]").each(function(){var e=b(this),c=e.attr("datetime"),m=e.data("short");l.lang(m?q+"-short":q);if(c=l(c))e.text(c.fromNow()),e.attr("title",c.format("LLLL"))})};window.setInterval(e,6E4);n.on(n.types.updateRelativeDates,e);e()})();
(function(){var b=window.$svjq,l=window.sv,n=l.PortletUtil,q=l.KeyUtil,e=q.KEY,p={},h,c=window._sv,m={success:function(){},selected:function(){},placeholder:"",markAdmins:!1,hitTemplate:c.template('<li data-user-identity="<%= id %>" class="sv-clearfix">   <img class="sv-contact-img sv-buddy-icon" src="<%= iconURL %>" />   <% if ((typeof(isMember) !== \'undefined\' && isMember) || (typeof(isAdmin) !== \'undefined\' && isAdmin) || (typeof(isContact) !== \'undefined\' && isContact)) { %><div style="float:right"><i class="halflings-icon ok"></i></div><% } %>   <div class="sv-user-info-container">     <h3 class="sv-contact-name"><%= name %></h3>     <p>     <% _.each(userfields, function(field) { %>        <%= field.value %><br/>     <% }); %>     </p>   </div></li>'),
adminHitTemplate:c.template('<li data-user-identity="<%= id %>" class="sv-clearfix">   <img class="sv-contact-img sv-buddy-icon" src="<%= iconURL %>" />   <% if ((typeof(isAdmin) !== \'undefined\' && isAdmin)) { %><div style="float:right"><i class="halflings-icon ok"></i></div><% } %>   <div class="sv-user-info-container">     <h3 class="sv-contact-name"><%= name %></h3>     <p>     <% _.each(userfields, function(field) { %>        <%= field.value %><br/>     <% }); %>     </p>   </div></li>')},u=
function(c,b){var e;if(!b&&p[c])return p[c];e=l.i18n.getText("portlet.util.searchuserutil",c,b);b||(p[c]=e);return e};l.SearchUserUtil={showSearchPopover:function(c){var s=b.extend({},m,c),p=b(s.target),w=0;if(p.hasClass("sv-fn-popover-showing"))b(".popover").remove(),p.removeClass("sv-fn-popover-showing");else{b(".popover").remove();p.addClass("sv-fn-popover-showing").popover({html:!0,container:0<p.closest(".modal").length?p.closest(".modal"):!1,title:'<input type="text" placeholder="'+(s.placeholder||
"")+'" data-fn-user-search class="input-medium search-query"/>',placement:"bottom",content:'<ul class="sv-user-search-list sv-defaultlist"></ul>',trigger:"manual"});p.popover("show");var z=function(a){b(a.target).is(".popover *")||(b(".popover").remove(),p.removeClass("sv-fn-popover-showing"),b("body").unbind("click",z))};b("body").bind("click",z);b("[data-fn-user-search]").focus().closest(".popover").addClass("sv-usersearch-popover");var B=n.getModelObjectUri(l.PageContext.pageId,"userIdentitySearch",
l.PageContext.pageId)+"?userfields=true",v=b(".popover-content").find("ul"),a=[];s.group&&(B+="&group="+s.group);s.userIdentity&&(B+="&identity="+s.identity);v.css("max-height",window.innerHeight-v.offset().top-10+"px");b("[data-fn-user-search]").keydown(function(c){c=q.getKeyCodeFromEvent(c);if(c===e.DOWN){w++;if(s.searchUrl&&w>a.length||!s.searchUrl&&w>a.length-1)w=0;v.children().removeClass("active").eq(w).addClass("active");return!1}if(c===e.UP)return w--,0>w&&(w=s.searchUrl?a.length:a.length-
1),v.children().removeClass("active").eq(w).addClass("active"),!1}).keyup(function(c){c=q.getKeyCodeFromEvent(c);if(c===e.ESC)return b(".popover").remove(),p.removeClass("sv-fn-popover-showing"),!1;if(c===e.RETURN){if(w===a.length)return 0<w&&"undefined"!==typeof v.children().eq(w).find("a").attr("href")?location.href=v.children().eq(w).find("a").attr("href"):""!==b(this).val()&&(location.href=s.searchUrl+"&query="+b(this).val()),!1;if("undefined"!==typeof a[w])return b(".popover").remove(),p.removeClass("sv-fn-popover-showing"),
s.selected&&s.selected.call(this,a[w]),!1}else{if(q.isNonTextModifiableKeyCode(c))return!1;var k=this;h&&clearTimeout(h);h=setTimeout(function(){w=0;v.empty();var c=b(k).val();""!==c&&b.ajax({url:B,dataType:"json",data:{term:c}}).done(function(e){e.queryString===b(k).val()&&(w=0,v.empty(),a=e.hits,b.each(a,function(a,c){var e=s.markAdmins?b(s.adminHitTemplate(c)):b(s.hitTemplate(c));v.append(e);e.click(function(){b(".popover").remove();p.removeClass("sv-fn-popover-showing");s.selected&&s.selected.call(this,
c);return!1}).mouseenter(function(){v.children().removeClass("active");w=a;b(this).addClass("active")})}),s.searchUrl&&0<a.length&&(e=u("showAll"),10>a.length&&(e=u("showAsList")),b('<li class="sv-showmore"><a href="'+s.searchUrl+"&query="+c+'">'+e+"</a></li>").appendTo(v).mouseenter(function(){v.children().removeClass("active");w=a.length}).click(function(){location.href=b(this).find("a").attr("href");return!1}),w=a.length),v.children().eq(w).addClass("active"),s.success&&s.success.call(this,a))})},
200)}})}}}})();
(function(){function b(c,b){var e;if(!b&&m[c])return m[c];e=n.i18n.getText("portlet.util.userinformation",c,b);b||(m[c]=e);return e}function l(b){var m=b.data("user-identity"),l=b.data("fn-show-user-popup-subtitle"),l=e.escape(b.attr("title"))+(l?"<small> "+e.escape(l)+"</small>":""),m=h.getModelObjectUri(n.PageContext.pageId,"userStatus",m);b.addClass("user-popover-loaded").webuiPopover({trigger:"hover",delay:300,type:"async",title:l,placement:"auto",url:m,content:function(b){b=JSON.parse(b);c.extend(b,
{showAddContact:b.userIdentityAvailable&&b.requestedUserIdentityAvailable,showSendMessage:b.userIdentityAvailable&&b.requestedUserIdentityAvailable&&0<c(".sv-messages-portlet").length});return(new k({model:new u(b)})).getContent()}})}var n=window.sv,q=window.SVBackbone,e=window._sv,p=n.Events,h=n.PortletUtil,c=window.$svjq,m={},u=q.Model.extend({defaults:{fields:[],contacts:0,groups:0,showSendMessage:!1},url:function(){return h.getModelObjectUri(n.PageContext.pageId,"userStatus",this.id)}}),k=q.View.extend({tagName:"div",
className:"bootstrap",template:e.template('<div class="bootstrap"><img style="float:left; margin-right:8px;" class="sv-buddy-icon" src="<%= largeBuddyIcon %>" /><div style="overflow: hidden" class="sv-userfields">    <% _.each(fields, function(field) { %>       <%- field %><br/>    <% }); %></div><div style="clear:left; padding-top:10px; margin-bottom:3px" class="sv-clearfix">    <div style="float:left;margin-top: 7px;"><img src="/sitevision/core/<%= status %>.png"/></div>       <div style="float:left;margin-top: 4px;"><small><%= statusText %></small></div>       <div style="float:right;padding-left: 10px;">         <% if (showAddContact && contact === \'false\') { %>           <button data-user-identity="<%= id %>" class="btn btn-mini btn-default sv-add-contact">'+
b("addAsContact")+'</button>         <% } %>         <% if (showSendMessage && self === \'false\') { %>           <button data-user-identity="<%= id %>" class="btn btn-mini btn-primary sv-send-message"><i class="halflings-icon comments white"></i> '+b("message")+"</button>         <% } %>       </div>    </div></div>"),getContent:function(){return this.template(this.model.toJSON())}});c("body").on("mouseenter","[data-user-identity][data-fn-show-user-popup]",function(){var b=c(this);b.hasClass("user-popover-loaded")||
(l(b),b.trigger("mouseenter"))});c("body").on("click","button.sv-send-message[data-user-identity]",function(){var b=c(this);p.trigger("sendMessage",b.data("user-identity"));b.closest("[data-user-identity][data-fn-show-user-popup]").webuiPopover("hide");return!1});c("body").on("click","button.sv-add-contact[data-user-identity]",function(){var b=c(this);c.post(h.getModelObjectUri(n.PageContext.userIdentityId,"addContact"),{id:b.data("user-identity")});c('[data-user-identity="'+b.data("user-identity")+
'"][data-fn-show-user-popup]').removeClass("user-popover-loaded").webuiPopover("destroy");return!1})})();
(function(){function b(c){c=c.serializeArray();var b={};e.each(c,function(c,e){b[e.name]=e.value});return b}var l=window.sv,n=l.PortletUtil,q=l.DialogUtil,e=window.$svjq,p=function(c){return l.i18n.getText("portlet.social.userfields.userfields",c)},h=function(c){return l.i18n.getText("common",c)},c=function(c){var b=!0;"function"===typeof c.checkValidity&&(b=c.checkValidity());return b};l.UserSettingsUtil={popupUserSettingsDialog:function(m){var u=e("<div/>").addClass("sv-userfields-content"),k=e("<form/>").addClass("form-horizontal sv-userfields-form");
u.append(k);e.ajax({type:"GET",dataType:"json",url:n.getModelObjectUri(l.PageContext.userIdentityId,"userfields",l.PageContext.userIdentityId),data:{fields:m||"all"},success:function(m){e.each(m.fields,function(c,b){var h=e("<div/>").addClass("control-group");k.append(h);var a=e("<label/>").addClass("control-label").text(b.name);h.append(a);a=e("<div/>").addClass("controls");h.append(a);"true"===b.writeable?"text_field"===b.type?(h=e("<textarea/>").attr({rows:"3",id:b.id,name:b.id,"data-errorMsg":b.validationErrorMessage}).addClass("input-xlarge"),
"no_validation"!==b.validationType&&("reg_exp_validation"===b.validationType&&b.regularExpression&&h.attr("pattern",b.regularExpression),b.value&&h.attr("required",""),h.attr("data-validation","true")),a.append(h),b.value&&h.val(b.value)):(h=e("<input/>").attr({type:b.type,id:b.id,name:b.id,"data-errorMsg":b.validationErrorMessage}).addClass("input-xlarge"),"no_validation"!==b.validationType&&("reg_exp_validation"===b.validationType&&b.regularExpression&&h.attr("pattern",b.regularExpression),b.value&&
h.attr("required",""),h.attr("data-validation","true")),a.append(h),b.value&&h.val(b.value),b.description&&(h=e("<span/>").addClass("help-block help").text(b.description),a.append(h))):b.value&&a.append(e("<label/>").attr({title:b.description}).css("padding-top","5px").text(b.value))});if(m.passwordRequired){var t=e("<div/>").addClass("control-group").addClass("well");k.append(t);var w=e("<label/>").addClass("control-label").text(p("password_field_title"));t.append(w);w=e("<div/>").addClass("controls");
t.append(w);t=e("<input/>").attr({id:"password",name:"password",type:"password"}).addClass("input-xlarge");w.append(t);t=e("<span/>").addClass("help-block help").text(p("password_field_description"));w.append(t)}k.find("input").not('[type="password"]').on("keyup",function(b){b=e(b.target);b.val().length&&b.attr("data-validation")?b.attr("required","required"):b.removeAttr("required")});w=[{text:h("cancel")},{text:h("ok"),skipDismiss:!0,primary:!0,callback:function(){e(".help-block").remove(".error");
e(".help-block").remove(".serverside-error");e(".control-group").removeClass("error");e(".alert").hide();if(c(k.get(0))){var q=b(k);e.ajax({type:"PUT",dataType:"JSON",url:n.getModelObjectUri(l.PageContext.userIdentityId,"userfields",l.PageContext.userIdentityId),data:JSON.stringify(q),processData:!1,success:function(b){if(b.success)n.reloadPortletsByType(".sv-userfields-portlet"),n.reloadPortletsByType(".sv-profileprogress-portlet"),e(".modal").modal("hide");else if(b.serverError){var a=e(".alert");
a.show();a.find(".alert-title").text(h("error"));a.find(".alert-message").text(p(b.serverError));"wrong_password"===b.serverError&&(b=u.find("#password"),b.parents(".control-group").addClass("error"),b.focus())}else e.each(b.failedFields,function(a,b){var c=e("#"+b);c.parents(".control-group").addClass("error");c.nextAll(".serverside-error").length||(c.nextAll(".help-block.error").remove(),c.after(e("<span/>").addClass("help-block help serverside-error").text(c.attr("data-errorMsg"))))})},error:function(){e(".alert").show()}})}else{var t=
e("#password");t.length&&!c(t.get(0))&&(t.get(0).focus(),t.parents(".control-group").addClass("error"),e(".alert").show(),e(".alert").find(".alert-title").text(h("error")),e(".alert").find(".alert-message").text(p("wrong_password")));e.each(m.fields,function(b,a){t=e("#"+a.id);"true"!==a.writeable||c(t.get(0))||(t.get(0).focus(),t.parents(".control-group").addClass("error"),t.nextAll(".serverside-error, .error").length||t.after(e("<span/>").addClass("help-block help error").text(t.attr("data-errorMsg"))))})}}}];
q.showDialog({title:p("dialogTitle"),body:u,buttons:w,removeOnHide:!0,errorTitle:p("errorTitle"),errorMsg:p("errorMsg")})}})}}})();
(function(){var b=window.$svjq,l=window.sv.Events,n=window.LazyLoad,q,e=function(b){q?b.call():(n.css("/sitevision/ajax/jquery/plugins/videojs/video-js.css"),n.js("/sitevision/ajax/jquery/plugins/videojs/video.js",function(){q=!0;window.videojs.options.flash.swf="/sitevision/ajax/jquery/plugins/videojs/video-js.swf";b.call()}))},p=function(h){h=h||b(".sv-timeline-portlet, .sv-video-portlet, .sv-timelineentry-portlet");h.find("video:not(.sv-video-js-loaded)").each(function(){var c=b(this);e(function(){c.addClass("sv-video-js-loaded");
window.videojs(c.get(0),{width:"auto",height:"auto"})})})};l.on(l.types.updateVideoLinks,p);p()})();(function(){window.sv.WindowLocationUtil={setHashValue:function(b,l){window.location.hash="#"+b+"/"+l},getHashValue:function(b){var l=window.location.hash,n=2+b.length;if(0===l.indexOf("#"+b+"/")&&l.length>n)return l.substring(n)},clearHashValue:function(){window.location.hash=""},hasHashValue:function(){var b=window.location.hash;return 0===b.indexOf("#")&&1<b.indexOf("/")},reloadPage:function(){location.reload()}}})();
(function(){var b=window.$svjq,l=window.sv.i18n,n=window.sv,q=n.PortletUtil,e=n.ClientUtil,p=n.Ajax;b(".sv-archive-portlet").on("click",".sv-create-article-entry",function(){var h=b(this),c=h.data("archive-id"),m=h.data("template-id"),n=h.data("use-new-editor"),h=h.parent(),k=b("<div>").addClass("sv-loading-icon").text(l.getText("portlet.archive.archive","creatingArticle"));h.empty().append(k);p.doPost({url:q.getEditApiUri({objectId:c,contextNodeId:c,modelHandler:"article"}),data:{template:m,portletType:"archive"},
success:function(b){window.location.href=n||e.isMobileDevice?"/edit/"+b.nodeId:"/editor/index.jsp?objectId="+b.nodeId}});return!1})})();
(function(){var b=window.$svjq,l=window.sv.i18n,n=window.sv,q=n.PortletUtil,e=n.ClientUtil,p=n.Ajax;b(".sv-blog-portlet").on("click",".sv-create-blog-entry",function(){var h=b(this),c=h.data("archive-id"),m=h.data("template-id"),n=h.data("use-new-editor"),h=h.parent(),k=b("<div>").addClass("sv-loading-icon").text(l.getText("portlet.blog.blog","creatingBlogEntry"));h.empty().append(k);p.doPost({url:q.getEditApiUri({objectId:c,contextNodeId:c,modelHandler:"article"}),data:{template:m,portletType:"blog"},
success:function(b){window.location.href=n||e.isMobileDevice?"/edit/"+b.nodeId:"/editor/index.jsp?objectId="+b.nodeId}});return!1})})();
(function(){function b(b){var c=b.find("[data-comments2-entry]");l(b);if(0!==c.length){var h=e.getObjectId(b.attr("id")),k=c.data("js-namespace"),p=c.data("profilepageurl"),c=c.data("tagresultpageurl"),t=new D(n[k].comments||[],{id:h,portletId:h});w=n[k].maxCharacterCount;z=n[k].useCaptcha;new G({el:b,collection:t,commentTemplate:q.getTemplate(b,"comments2-comment"),portletId:h,profilePageURL:p,tagResultPageURL:c});h=b.find(".sv-comments2-comments");0<h.length&&(a(h,p),x(h,c));p=m.cookie("fullName");
null!==p&&0<p.length&&b.find("[data-fn-comments2-input-name]").val(p);b.find(".sv-comment-hidden").attr("title",v("hiddenComment"))}}function l(a){var c=e.getObjectId(a.attr("id"));a.off("click","[data-fn-comment2-toggle-close]");a.on("click","[data-fn-comment2-toggle-close]",function(e){e.preventDefault();e=q.getPortletUri(c,"toggleVisible");m.get(e,function(c){a.find(".sv-comments2-portlet-content").html(c);b(a)})});a.off("click","[data-fn-comment2-toggle-mutable]");a.on("click","[data-fn-comment2-toggle-mutable]",
function(b){b.preventDefault();b=q.getPortletUri(c,"toggleMutable");m.get(b,function(){a.find("[data-sv-comments2-closed-title]").hasClass("sv-hidden")?(a.find("[data-sv-comments2-closed-title]").removeClass("sv-hidden"),a.find(".sv-comments2-form").addClass("sv-hidden"),a.find("[data-sv-comments2-disallow-comments]").addClass("sv-hidden"),a.find("[data-sv-comments2-allow-comments]").removeClass("sv-hidden")):(a.find("[data-sv-comments2-closed-title]").addClass("sv-hidden"),a.find(".sv-comments2-form").removeClass("sv-hidden"),
a.find("[data-sv-comments2-disallow-comments]").removeClass("sv-hidden"),a.find("[data-sv-comments2-allow-comments]").addClass("sv-hidden"))})})}var n=window.sv,q=n.PortletUtil,e=n.ObjectUtil,p=n.Events,h=n.KeyUtil,c=h.KEY,m=window.$svjq,u=n.Ajax,k=window.SVBackbone,s=window._sv,t={},w,z,B={triggers:{"@":{source:q.getModelObjectUri(n.PageContext.pageId,"userIdentitySearch",n.PageContext.pageId),searchKey:"term",allowWhiteSpace:!0,maxWhiteSpace:2,parse:function(a){return a.hits}}},minLength:2,replacer:function(a){return a.trigger+
'{"value":"'+a.name+'","id":"'+a.id+'"}'}},v=function(a,b){var c;if(!b&&t[a])return t[a];c=n.i18n.getText("portlet.comments2.comments",a,b);b||(t[a]=c);return c},a=function(a,b){a.find("a[data-user-identity]").each(function(){var a=m(this);a.attr("href",b+"?identity="+a.data("user-identity"))})},x=function(a,b){a.find("a[data-social-tag-id]").each(function(){var a=m(this);a.attr("href",b+"?tag="+a.data("social-tag-name"))})},A=k.Model.extend({defaults:{removeTitle:v("removeCommentTitle"),editTitle:v("editCommentTitle")},
url:function(){return this.collection?this.collection.url()+"&commentId="+this.get("id"):"?commentId="+this.get("id")}}),D=k.Collection.extend({model:A,initialize:function(a,b){this.options=b;this.bindServerEvents()},bindServerEvents:function(){var a=this;p.on("server-pagecomment-added-"+n.PageContext.pageId,function(b){a.add(b.content,{append:!0})})},url:function(){return q.getPortletResourceUri(this.options.portletId,"comment")+"&file="+this.options.id}}),F=k.View.extend({tagName:"li",className:function(){return this.model.get("hidden")?
"sv-comment2-comment sv-comment-hidden":"sv-comment2-comment"},events:{"click [data-fn-destroy-comment]":"showDestroyDialog","click [data-fn-edit-comment]":"editComment","click [data-fn-hide-comment]":"doHide","click [data-fn-show-comment]":"doHide"},initialize:function(){this.listenTo(this.model,"change:comment",this.updateComment,this);this.listenTo(this.model,"destroy",this.remove,this);this.listenTo(this.model,"change:hidden",this.hide,this)},showDestroyDialog:function(){var a=this;n.DialogUtil.showConfirmDialog(v("removeCommentTitle"),
v("removeCommentBody"),function(b){b&&a.model.destroy({wait:!0})});return!1},editComment:function(a){a.preventDefault();u.doGet({context:this,url:q.getPortletResourceUri(this.options.portletId,"comment")+"&commentId="+this.model.get("id")}).done(function(a){this.showEditComment(a.plainMessage,a.mentions)})},showEditComment:function(a,b){var c=this,e=this.model.get("id"),h=m("<div/>"),k=m('<span class="sv-float-right">'+(w-a.length)+"</span>"),l=m("<textarea/>").attr("id","editComment").addClass("sv-comment-input sv-border-box").on("keyup",
s.bind(function(a){a=w-a.currentTarget.value.length;0>a?(k.addClass("sv-character-limit-exceeded"),this.getSaveEditCommentButton().addClass("disabled").attr("disabled","disabled")):(k.removeClass("sv-character-limit-exceeded"),this.getSaveEditCommentButton().removeClass("disabled").removeAttr("disabled"));k.text(a)},this)).val(a);h.addClass("sv-comments2-portlet").append(l).append(k);var p=[{text:v("save"),callback:m.proxy(function(){u.doPut({url:q.getPortletResourceUri(c.options.portletId,"comment")+
"&commentId="+e,data:{comment:l.triggeredInput("getRichContent")},context:this}).done(function(a){this.model.set(a)})},this)}];n.DialogUtil.showDialog({title:v("editCommentTitle"),body:h,buttons:p,shownCallback:function(){l.triggeredInput(B).triggeredInput("setIds",b).elastic()}});return!1},getSaveEditCommentButton:function(){this.$saveEditButton||(this.$saveEditButton=m(".modal-footer button"));return this.$saveEditButton},updateComment:function(a){a.get("hidden")&&!a.get("isAdmin")?a.collection.remove(a):
(this.render(),p.trigger(p.types.updateLikables,this.$el),p.trigger(p.types.updateRelativeDates,this.$el))},doHide:function(a){a.preventDefault();this.model.set({hidden:!this.model.get("hidden")});this.model.save({},{url:q.getPortletResourceUri(this.model.collection.options.portletId,"toggleVisibleComment")+"&commentId="+this.model.id})},hide:function(){this.model.get("hidden")?(this.$el.addClass("sv-comment-hidden"),this.$el.attr("title",v("hiddenComment")),this.$el.find("[data-fn-hide-comment]").addClass("sv-hidden"),
this.$el.find("[data-fn-show-comment]").removeClass("sv-hidden"),this.$el.find(".sv-comments2-hidden-comment-text").removeClass("sv-hidden")):(this.$el.removeClass("sv-comment-hidden"),this.$el.removeAttr("title"),this.$el.find("[data-fn-hide-comment]").removeClass("sv-hidden"),this.$el.find("[data-fn-show-comment]").addClass("sv-hidden"),this.$el.find(".sv-comments2-hidden-comment-text").addClass("sv-hidden"))},render:function(){this.$el.html(this.options.template(this.model.toJSON()));this.model.toJSON().hidden&&
this.$el.attr("title",v("hiddenComment"));a(this.$el,this.options.profilePageURL);x(this.$el,this.options.tagResultPageURL);return this}}),G=k.View.extend({initialize:function(){this.$list=this.$el.find("[data-fn-comments2]");this.collection.on("add",this.addNewComment,this);this.collection.on("remove",this.removeComment,this);this.$el.find("[data-fn-comments2-input]").triggeredInput(B).elastic();0<this.collection.length&&this.render()},render:function(){this.clearList();this.collection.each(function(a){this.appendOne(a)},
this);p.trigger(p.types.updateRelativeDates,this.$el);p.trigger(p.types.updateLikables,this.$el)},clearList:function(){this.$list.empty()},appendOne:function(a){a=(new F({model:a,portletId:this.options.portletId,template:this.options.commentTemplate,profilePageURL:this.options.profilePageURL,tagResultPageURL:this.options.tagResultPageURL})).render().$el;var b=a.find(".sv-comments2-content").find(".sv-truncate-more"),c;0<b.length&&(this.addShowMoreLink(b),c=!0);this.$list.append(a);c&&this.bindShowMoreEvents(a)},
bindShowMoreEvents:function(a){var b=v("showMore"),c=v("showLess"),e=m(".sv-truncate-more-link",a),h=m(".sv-truncate-more",a),k=m(".sv-truncate-ellipsis",a);e.on("click",function(a){a.preventDefault();e.text()===b?(h.show(),e.text(c),k.css("display","none")):(h.hide(),e.text(b),k.css("display","inline"))})},addShowMoreLink:function(a){m('<span class="sv-truncate-ellipsis">...</span>').insertBefore(a);m('<div><a href="#" class="sv-truncate-more-link">'+v("showMore")+"</a></div>").insertAfter(a);a.css("display",
"none")},addNewComment:function(a){void 0!==a.toJSON().author?this.appendOne(a):p.trigger(p.types.notifyUser,{type:"default",heading:v("moderatedHeading"),message:v("moderatedBody"),transient:!0});p.trigger(p.types.updateRelativeDates,this.$el);p.trigger(p.types.updateLikables,this.$el)},removeComment:function(a){this.render();a.get("hidden")&&p.trigger(p.types.notifyUser,{type:"default",heading:v("moderatedHeading"),message:v("moderatedBody"),transient:!0})},getLoader:function(){this.$loader||(this.$loader=
m('<img src="/sitevision/util/images/loading_16_grey.gif" />').css("vertical-align","middle").appendTo(this.$el.find("[data-fn-comment-input]").parent()));return this.$loader},events:{"focus [data-fn-comments2-input]":"expandTextfield","click [data-fn-comments2-input]":"expandTextfield","keyup [data-fn-comments2-input]":"countdownCharactersLeft","keyup [data-fn-comments2-input-name]":"countdownCharactersLeft","keydown [data-fn-comments2-input]":"checkKeyDown","submit [data-fn-comments2-form]":"postComment"},
expandTextfield:function(a){m(a.currentTarget).addClass("sv-message-input-expanded");this.$el.find(".sv-submit-controls").show();this.countdownCharactersLeft(a)},shrinkTextfield:function(){this.$el.find(".sv-message-input-expanded").removeClass("sv-message-input-expanded");this.$el.find(".sv-submit-controls").hide()},getTextField:function(){this.$textField||(this.$textField=this.$el.find("[data-fn-comments2-input]"));return this.$textField},countdownCharactersLeft:function(a){a=m(a.currentTarget);
var b=a.val(),b=w-b.length,c=this.$el.find("[data-fn-comments2-input-size]");0>b?c.addClass("sv-character-limit-exceeded"):c.removeClass("sv-character-limit-exceeded");c.text(b);""!==a.val()&&0<=b&&!this.activeConnection?this.enableSubmitButton():this.disableSubmitButton()},checkKeyDown:function(a){if(h.getKeyCodeFromEvent(a)===c.RETURN&&a.ctrlKey)return this.getSubmitButton().focus(),this.$el.find("[data-fn-comments2-form]").submit(),!1},postComment:function(a){var b=this,c,e,h,k;if(!a.isPropagationStopped()&&
!a.isDefaultPrevented()){a.preventDefault();if(this.activeConnection)return!1;c=this.$el.find("[data-fn-comments2-input]");k=b.getNameField();a=c.val().length;if(1===k.length&&0===k.val().length)return p.trigger(p.types.notifyUser,{type:"default",heading:v("noNameHeading"),message:v("noNameBody"),transient:!0}),!1;if(0<a&&a<=w){if(z&&(e=(e=this.$el.find("#g-recaptcha-response"))&&e[0].value,!e))return this.$el.find("#sv-help-block-verify").show(),!1;this.disableSubmitButton();this.activeConnection=
!0;e=new A({comment:c.triggeredInput("getRichContent"),fullName:k.val(),useCaptcha:z,recaptchaResponse:e||""});a=b.$el.find("[data-sv-spam-marker]");0<a.length&&(e.attributes[a.attr("name")]=a.val());h=setTimeout(function(){b.getLoader().show()},400);this.collection.create(e,{wait:!0,success:function(){c.val("");b.activeConnection=!1;b.getLoader().hide();clearTimeout(h);m.cookie("fullName",k.val());z&&b.$el.find("#recaptcha-container").hide()},error:function(){b.activeConnection=!1;b.getLoader().hide();
clearTimeout(h);b.enableSubmitButton();p.trigger(p.types.notifyUser,{type:"error",heading:v("postFailedHeading"),message:v("postFailedBody"),transient:!0})}});this.shrinkTextfield()}else a>w&&p.trigger(p.types.notifyUser,{type:"default",heading:v("commentToLongHeading"),message:v("commentToLongBody"),transient:!0});return!1}},getSubmitButton:function(){this.$submitButton||(this.$submitButton=this.$el.find("[data-fn-comments2-submit]"));return this.$submitButton},getNameField:function(){this.$NameField||
(this.$NameField=this.$el.find("[data-fn-comments2-input-name]"));return this.$NameField},disableSubmitButton:function(){this.getSubmitButton().addClass("disabled").attr("disabled","disabled")},nameFieldOK:function(){var a=this.getNameField();return 0===a.length||a.val()?!0:!1},enableSubmitButton:function(){""!==this.getTextField().val()&&this.nameFieldOK()&&this.getSubmitButton().removeClass("disabled").removeAttr("disabled")}});m(".sv-comments2-portlet").each(function(){var a=m(this);b(a)})})();
(function(){function b(b){this.options=b;this.bindLinkListener()}var l=window.$svjq,n=window.sv,q=/^[A-Z0-9._%+\-]+@([A-Z0-9][.\-]?)+[A-Z0-9]+\.[A-Z]{2,6}$/i;b.prototype={bindLinkListener:function(){var b=this;this.options.$portlet.find("."+this.options.linkClass).on("click",function(){b.openDialog.call(b,this);return!1})},getDialogContainer:function(){this.$dialogContainer||(this.$dialogContainer=l("<div/>"));return this.$dialogContainer},showMessageDialog:function(b){this.$subDialogContainer?this.$subDialogContainer.html(b).svDialog("open"):
this.$subDialogContainer=l("<div/>").html(b).svDialog({open:!0,title:this.options.sendMessageTitle,buttons:[{text:this.options.closeButtonText,type:"primary",callback:l.proxy(function(){this.$subDialogContainer.svDialog("close")},this)}]})},validateForm:function(){var b=!0,n=this.getDialogContainer().find("form");l.each(this.options.requiredFields,l.proxy(function(h,c){var m=n.find("[name="+c+"]");this.validateField(m)||(b=!1)},this));return b},validateField:function(b){var l=b.is("[name=emailAddress]");
if(this.checkRequiredField(b)){if(l&&!this.checkEmailAddress(b))return this.appendErrorMessage(b,this.options.errorMessages.emailInvalid),!1;this.removeValidationErrors(b);return!0}this.appendErrorMessage(b,this.options.errorMessages[b.attr("name")]);return!1},checkEmailAddress:function(b){if(0===b.length)return!0;b=b.val();return""===l.trim(b)&&-1===l.inArray("emailAddress",this.options.requiredFields)||q.test(b)},checkRequiredField:function(b){var n=!1;return-1===l.inArray(b.attr("name"),this.options.requiredFields)?
!0:n=b.is("[type=checkbox]")?b.is(":checked")||0<b.siblings("input[type=checkbox]").filter(":checked").length:!!l.trim(b.val())},appendErrorMessage:function(b,n){b.siblings(".sv-contact2-error-message-container").remove();b.addClass("sv-contact2-warned");var h=l("<label/>",{"for":b.attr("id"),"class":this.options.errorFont}).html('<img alt="" style="border:none; width:16px; height:16px; vertical-align:middle" src="'+this.options.errorImageSrc+'"/> '+n);l('<div class="sv-contact2-error-message-container" />').append(h).appendTo(b.parent())},
removeValidationErrors:function(b){(b?b.parent():this.getDialogContainer()).find(".sv-contact2-error-message-container").remove()},handleSubmit:function(){var b=this.options.ajaxFormUrl,n;this.validateForm()&&(this.options.attachmentField?this.getDialogContainer().find("form").submit():(n=this.getDialogContainer().find("form").serialize(),l.post(b,n,l.proxy(function(b){this.closeDialog();this.showMessageDialog(b)},this))))},closeDialog:function(){this.getDialogContainer().svDialog("close")},buildDialogUrl:function(b){return this.options.ajaxSendBaseUrl+
"&contactUserId="+b.substring(3).replace("_",".")},openDialog:function(b){var n=this.getDialogContainer();if(this.dialogCreated)n.svDialog("setURL",this.buildDialogUrl(b.id)).svDialog("open");else{n.svDialog({open:!0,url:this.buildDialogUrl(b.id),title:this.options.sendMessageTitle,modal:this.options.useModalDialog,buttons:[{text:this.options.submitButtonText,type:"primary",callback:l.proxy(this.handleSubmit,this)},{text:this.options.cancelButtonText,type:"link",callback:l.proxy(this.closeDialog,
this)}]});var h=this;n.on("change","input, textarea",function(){h.validateField(l(this))});n.on("keyup","input[type=text].sv-contact2-warned, textarea.sv-contact2-warned",function(){h.validateField(l(this))});this.dialogCreated=!0}}};l(".sv-contact2-portlet").each(function(){var e=l(this),p=n.contact2[this.id.substring(4)];p&&(p.$portlet=e,p=new b(p),e.data("sv-contact2-portlet",p))})})();
(function(){var b=window.$svjq,l={};b(".sv-has-error").each(function(){var l=b(this);l.on("change keyup",function(){l.removeClass("sv-has-error");l.off()})});var n=function(n){var e=n.val();n=l[n.attr("id")];e=n.initialSize-b.trim(e).length;0>e?n.$el.addClass("sv-textfield-limit-exceeded"):n.$el.removeClass("sv-textfield-limit-exceeded");n.$el.text(e)};b(".sv-form-textfield.sv-limit-characters").each(function(){var q=b(this),e=q.parent().find(".sv-textfield-input-size"),p=q.attr("id");l[p]={$el:e,
initialSize:e.text()};q.on("keyup",function(e){n(b(e.currentTarget))});q.val().length&&n(q)})})();
(function(){function b(b,n,h,c,m,q){var k=window.hs,s=l.i18n.getLanguage();if("de"===s||"no"===s||"sv"===s)k.lang=k.lang[s];k.numberingClass=b;b={interval:n,repeat:!0,useControls:!m,fixedControls:"fit"};m||(b.overlayOptions={position:"bottom right",hideOnMouseOut:c,offsetY:h,offsetX:-3});q||(b.thumbstrip={position:"above",mode:"horizontal",relativeTo:"expander"});k.addSlideshow(b)}var l=window.sv,n=window.$svjq,q=window.LazyLoad;l.ImageAlbumUtil={createSlideShow:function(e,l,h,c,m,u){window.hs?b(e,
l,h,c,m,u):(q.css("/sitevision/ajax/highslide/highslide.css"),n.getScript("/sitevision/ajax/highslide/highslide_mod.js",function(){b(e,l,h,c,m,u)}))}}})();
(function(b,l){b.sv=b.sv||{};b.sv.responsiveTables=b.sv.responsiveTables||{};b.sv.responsiveTables.config=b.sv.responsiveTables.config||{};b.sv.responsiveTables.classNames={};b.sv.responsiveTables.selectors={};l.each([["groupName",""],["scroll","--scroll"],["fixedFirst","--fixedFirst"],["stackGroupName","--stacked"],["stackTable","--stackTable"],["stackColumns","--stackColumns"]],function(l,q){b.sv.responsiveTables.classNames[q[0]]="sv-responsiveTable"+q[1];b.sv.responsiveTables.selectors[q[0]]=".sv-responsiveTable"+
q[1]});b.sv.responsiveTables.config=l.extend({},{breakpoint:"767px",fixedFirstWidth:"35%",divClassTmpl:'<div class="<%= classNames %>" />',divStyleTmpl:'<div class="<%= classNames %>" style="<%= styleAttr %>" />',tblTmpl:'<table class="<%= classNames %>"><tbody></tbody></table>',tblThRowTmpl:'<tr class="<%= trClassNames %>"><th class="<%= thClassNames %>" colspan="<%= colSpan %>"><%= content %></th></tr>',tblTrRowTmpl:'<tr class="<%= trClassNames %>"><td class="<%= groupName %>__key"><%= keyContent %></td><td class="<%= groupName %>__value <%= cellClassName %>"><%= valueContent %></td></tr>'},
b.sv.responsiveTables.config)})(window,window.$svjq);
(function(b,l,n,q,e,p){var h=q.classNames,c=q.selectors,m=q.config;(function(){n.svRespTables||(n.svRespTables={});n.svRespTables.scroll=function(b){this.init=function(){n(b).removeClass(h.groupName).wrap(e(m.divClassTmpl,{classNames:h.groupName}))};this.init()};n.fn.svRespTables_scroll=function(){return this.each(function(){new n.svRespTables.scroll(this)})};n.svRespTables.fixedFirst=function(b){var k=this,l=h.groupName+" "+h.fixedFirst,t=q.mql,w=!1;k.$el=n(b);k.$el.data("svRespTables.fixedFirst",
k);k.init=function(){k.$el.removeClass(l).wrap(e(m.divClassTmpl,{classNames:l}))};k.splitTable=function(){k.$copy=k.$el.clone();k.$copy.css("width","100%").find("td:not(:first-child), th:not(:first-child)").hide().end().find("caption").html("&nbsp;");k.$el.closest(".sv-responsiveTable--fixedFirst").append(k.$copy);k.$copy.wrap(e(m.divStyleTmpl,{classNames:h.fixedFirst+"__pinned",styleAttr:"width: "+m.fixedFirstWidth}));k.$el.wrap(e(m.divStyleTmpl,{classNames:h.fixedFirst+"__scrollable",styleAttr:"margin-left: "+
m.fixedFirstWidth}));k.setCellHeights()};k.unSplitTable=function(){k.$el.closest(c.fixedFirst).find(c.fixedFirst+"__pinned").remove();k.$el.unwrap();k.$copy=p;k.unSetCellHeights()};k.setCellHeights=function(){var b=k.$el.find("tr"),c=k.$copy.find("tr"),e=[];b.each(function(a,b){n(b).find("th, td").each(function(){var b=n(this).outerHeight(!0);e[a]=e[a]||0;b>e[a]&&(e[a]=b)})});c.each(function(a,c){n(c).height(e[a]);b.eq(a).height(e[a])})};k.unSetCellHeights=function(){k.$el.find("tr").each(function(b,
c){c.style.height="auto"})};k.updateTables=function(){!t.matches&&w?(w=!1,k.unSplitTable()):t.matches&&!w&&(w=!0,k.splitTable())};t.addListener(k.updateTables);n(k.updateTables);k.init()};n.fn.svRespTables_fixedFirst=function(){return this.each(function(){new n.svRespTables.fixedFirst(this)})};n.svRespTables.stackTable=function(b){var c=this,l=q.mql;c.$el=n(b);c.$el.data("svRespTables.stackTable",c);c.init=function(){var b="",p,q;l.removeListener(c.init);c.$copy=n(e(m.tblTmpl,{classNames:c.$el.prop("class")+
" "+h.stackGroupName+"__smallOnly"}));c.$el.addClass(h.stackGroupName+"__largeOnly");p=c.$el.find("caption").clone();q=c.$el.find("tr").eq(0);c.$el.find("tr").each(function(c,k){var a=n(k),l="",p="",s,u=a.prop("class");0===c?b+=e(m.tblThRowTmpl,{trClassNames:u,thClassNames:h.stackGroupName+"__headRow "+h.stackGroupName+"__headRow--main",colSpan:2,content:a.find("th, td").eq(0).html()}):(a.find("td, th").each(function(a,b){var c=n(b);n.trim(c.html())&&(0===a?l+=e(m.tblThRowTmpl,{trClassNames:u,thClassNames:h.stackGroupName+
"__headRow",colSpan:2,content:c.html()}):(s=n.trim(q.find("td,th").eq(a).html()),p+=e(m.tblTrRowTmpl,{trClassNames:u,groupName:h.stackGroupName,keyContent:s?s:"",cellClassName:c.prop("class"),valueContent:c.html()})))}),b+=l+p)});c.$copy.find("tbody").before(p).html(b);c.$el.before(c.$copy)};l.matches?c.init():l.addListener(c.init)};n.fn.svRespTables_stackTable=function(){return this.each(function(){new n.svRespTables.stackTable(this)})};n.svRespTables.stackColumns=function(b){var c=this,l=q.mql;
c.$el=n(b);c.$el.data("svRespTables.stackColumns",c);c.init=function(){function b(c,a){var e=n(a),k=n("<tr></tr>"),l,m,p;0===c&&k.addClass(h.stackGroupName+"__headRow "+h.stackGroupName+"__headRow--main");l=e.find("td, th").eq(0).clone().addClass(h.stackGroupName+"__key");m=q;e.find("*[colspan]").length&&(p=0,e.find("td, th").each(function(a,b){var c=n(b).attr("colspan");if(p>q)return!1;c?(c=parseInt(c,10),m-=c-1,p+c>q&&(m+=p+c-q-1),p+=c):p++}));e=e.find("td, th").eq(m).clone();e.addClass(h.stackGroupName+
"__value").removeAttr("colspan");k.append(l,e);u.append(k)}var p=c.$el.find("tr").eq(0).find("td, th").length,q=1,u;l.removeListener(c.init);if(!(3>p)){c.$copy=n(e(m.tblTmpl,{classNames:c.$el.prop("class")+" "+h.stackGroupName+"__smallOnly"}));c.$el.addClass(h.stackGroupName+"__largeOnly");c.$el.find("caption").length&&c.$copy.find("tbody").before(c.$el.find("caption").clone());for(u=n("<tbody />");q<p;)c.$el.find("tr").each(b),++q;c.$copy.find("tbody").append(u.html());c.$el.before(c.$copy)}};l.matches?
c.init():l.addListener(c.init)};n.fn.svRespTables_stackColumns=function(){return this.each(function(){new n.svRespTables.stackColumns(this)})}})()})(window,window.document,window.$svjq,window.sv.responsiveTables,window.sv.TemplateUtil.template);
(function(b,l,n,q,e){var p,h=e.selectors;e.init=function(){var b=n(l.getElementsByTagName("table")).filter(h.groupName);0<b.length&&(e.appendCSS(),b.filter(h.scroll).svRespTables_scroll().end().filter(h.fixedFirst).svRespTables_fixedFirst().end().filter(h.stackTable).svRespTables_stackTable().end().filter(h.stackColumns).svRespTables_stackColumns())};n(function(){p=n(l.body);b.matchMedia&&p.hasClass("sv-responsive")&&!p.hasClass("sv-editing-mode")&&(e.mql=window.matchMedia("(max-width: "+e.config.breakpoint+
")"),e.init())})})(window,window.document,window.$svjq,window.sv,window.sv.responsiveTables);
(function(b,l){var n,q;function e(b){var e=document.createElement("style");e.appendChild(document.createTextNode(""));document.head.appendChild(e);b&&e.setAttribute("media","(max-width: "+b+")");return e.sheet}n=["div.sv-responsiveTable { overflow: auto; max-width: 100%; }","div.sv-responsiveTable * { white-space: nowrap !important; }","div.sv-responsiveTable--fixedFirst { position: relative; margin-bottom: 20px; overflow: hidden; border-right: 1px solid #ccc; }","div.sv-responsiveTable--fixedFirst table { margin-bottom: 0; overflow: visible; max-width: none; }",
"div.sv-responsiveTable--fixedFirst td, div.sv-responsiveTable--fixedFirst th { position: relative; overflow: hidden; }","div.sv-responsiveTable--fixedFirst__scrollable th:first-child, div.sv-responsiveTable--fixedFirst__scrollable td:first-child { display: none; }","div.sv-responsiveTable--fixedFirst__pinned { position: absolute; left: 0; top: 0; background: #fff; overflow: hidden; overflow-x: scroll; border-right: 1px solid #ccc; border-left: 1px solid #ccc; }","div.sv-responsiveTable--fixedFirst__pinned table { border-right: none; border-left: none; width: 100%; }",
"div.sv-responsiveTable--fixedFirst__pinned td:first-child, div.sv-responsiveTable--fixedFirst__pinned th:first-child { width: 100%; }","div.sv-responsiveTable--fixedFirst__scrollable { overflow: scroll; overflow-y: hidden; }",".sv-responsiveTable--stacked { overflow: visible; }",".sv-responsiveTable--stacked__largeOnly { display: none; }",".sv-responsiveTable--stacked__smallOnly { display: table; }"];q=[".sv-responsiveTable--stacked__largeOnly { display: table; }",".sv-responsiveTable--stacked__smallOnly { display: none; }"];
l.appendCSS=function(){var p=e(),h=e(l.config.breakpoint);b.each(q,function(b,e){p.insertRule(e,b)});b.each(n,function(b,e){h.insertRule(e,b)})}})(window.$svjq,window.sv.responsiveTables);
(function(){var b=window.$svjq,l=window.sv,n=window._sv,q,e=function(e){var h=e.portletId,c=e.inputField,m=e.resultDiv,u=-1,k=-1,s=function(){m.hide()};b("body").bind("click",s);var t=function(a,b){if(-1<a){var c=b.find(".sv-searchform2-search-list-column"+a);if(1===c.length)return c}},w=function(a,c){if(-1<a&&a<c.children().length)return b(c.children()[a])},z=function(a,b,c){a=t(a,c);if(void 0!==a)return w(b,a)},B=function(a){var b=0,c=t(0,a);a=t(1,a);void 0!==c&&b++;void 0!==a&&b++;return b},v=
function(a){a.children().removeClass("active")};c.keydown(function(a){a=l.KeyUtil.getKeyCodeFromEvent(a);var b=t(0,m),c=t(1,m);void 0!==b&&void 0!==c&&(a===l.KeyUtil.KEY.RIGHT&&0===k?(k=1,u=-1,v(b),a=l.KeyUtil.KEY.DOWN):a===l.KeyUtil.KEY.LEFT&&1===k&&(k=0,u=-1,v(c),a=l.KeyUtil.KEY.DOWN));if(a===l.KeyUtil.KEY.DOWN||a===l.KeyUtil.KEY.UP){var e;if(0===k&&void 0!==b)e=b;else if(1===k&&void 0!==c)e=c;else if(-1===k){var h;h=m.hasClass("sv-searchform2-result-container-alignment-left")?"left":"right";"left"===
h?void 0!==b&&(k=0,e=b):void 0!==c?(k=1,e=c):void 0!==b&&(k=0,e=b)}a===l.KeyUtil.KEY.DOWN&&void 0!==e&&u+1<e.children().length?(a=w(u+1,e),u++,v(e),a.addClass("active")):a===l.KeyUtil.KEY.UP&&void 0!==e&&-1<u&&(u--,v(e),0<=u?w(u,e).addClass("active"):k=-1);return!1}}).keyup(function(a){a=l.KeyUtil.getKeyCodeFromEvent(a);a===l.KeyUtil.KEY.ESC?s():a===l.KeyUtil.KEY.RETURN?(a=z(k,u,m),void 0!==a?location.href=a.find("a").attr("href"):1===B(m)&&(a=t(0,m).find(".sv-searchform2-more-hits"),1===a.length&&
(location.href=a.find("a").attr("href")))):l.KeyUtil.isNonTextModifiableKeyCode(a)||(void 0!==q&&clearTimeout(q),q=setTimeout(function(){var a=c.val();k=u=-1;if(""===a||2>a.length)m.css("display","none");else{var e=l.PortletUtil.getPortletResourceUri(h,"query");b.ajax({url:e,data:{term:a}}).fail(function(a){m.html('<div class="sv-searchform2-message">'+l.i18n.getText("portlet.search.searchform2.searchform2","searchFailed",a.status)+"</div>")}).done(function(e){if(a===e.term){var h=e.facets;m.empty();
m.css("width","auto");if(0===h.length)h=n.template('<div class="sv-searchform2-message">   <<%= noHitsTag %> class="<%= noHitsClass %>"><%= noHitsText %></<%= noHitsTag %>></div>'),m.append(b(h(e)));else{var p=document.documentElement.clientWidth,q=e.width/2,t=q*h.length;t>p&&(300<p?(q=p/2,t=q*h.length):t=q>p?q=p:q);for(p=0;p<h.length;p++){var s=h[p],w;"content"===s.type?w='<div class="sv-border-box sv-searchform2-facet-column'+p+'" style="width: '+q+'px">   <<%= facetTag %> class="<%= facetTagClass %>"><%= name %></<%= facetTag %>>   <ul class="sv-defaultlist sv-user-search-list sv-searchform2-search-list sv-searchform2-search-list-column'+
p+'">      <% _.each(hits, function(hit){ %>         <li class="sv-searchform2-search-hit"><a class="sv-vamiddle <%= contentTagClass %>" href="<%= hit.URL %>" onclick="<%= hit.onClick %>"><%= hit.name %></a><% if (typeof(hit.iconURL) !== \'undefined\') { %><img alt="<%= hit.iconDescription %>" class="sv-noborder-vamiddle" src="<%= hit.iconURL %>" style="margin-left: 3px;"><% } %></li>      <% }); %>      <% if (showDetails) { %>         <li class="sv-clearfix sv-searchform2-search-hit sv-searchform2-more-hits"><<%= textTag %> class="<%= textTagClass %>"><a href="<%= showDetailsURL %>"><%= showDetailsText %></a></<%= textTag %>></li>      <% } %>   </ul></div>':
"users"===s.type?w='<div class="sv-border-box sv-searchform2-facet-column'+p+'" style="width: '+q+'px">   <<%= facetTag %> class="<%= facetTagClass %>"><%= name %></<%= facetTag %>>   <ul class="sv-defaultlist sv-user-search-list sv-searchform2-search-list sv-searchform2-search-list-column'+p+'">      <% _.each(hits, function(hit){ %>         <li class="sv-clearfix sv-searchform2-search-hit">            <img class="sv-buddy-icon sv-searchform2-user-img" src="<%= hit.iconURL %>" />            <% if (hit.isContact) { %><div style="float:right"><i class="halflings-icon ok"></i></div><% } %>            <div class="sv-searchform2-user-container">               <<%= userBlockTag %> class="sv-searchform2-user-name <%= userTagClass %>"><a href="<%= hit.profileURL %>" onclick="<%= hit.onClick %>"><%= hit.name %></a></<%= userBlockTag %>>               <% if (typeof(hit.userfields) !== \'undefined\') { %>                  <ul class="sv-searchform2-userfield-list">                     <% _.each(hit.userfields, function(userfield){ %>                        <li class="<%= textTagClass %> sv-wrap-words"><%= userfield.value %></li>                     <% }); %>                  </ul>               <% } %>            </div>         </li>      <% }); %>      <% if (showDetails) { %>         <li class="sv-clearfix sv-searchform2-search-hit sv-searchform2-more-hits"><<%= textTag %> class="<%= textTagClass %>"><a href="<%= showDetailsURL %>"><%= showDetailsText %></a></<%= textTag %>></li>      <% } %>   </ul></div>':
(w="",l.Log.error("Skipping unsupported facet type "+s.type));w=n.template(w);m.css("width",t);m.append(b(w(s)))}var z=m.find("ul.sv-user-search-list");z.find("li.sv-searchform2-search-hit").mouseenter(function(){var a=b(this);var c=a.parent();k=c.hasClass("sv-searchform2-search-list-column0")?0:c.hasClass("sv-searchform2-search-list-column1")?1:-1;u=a.index();v(z);a.addClass("active")}).mouseleave(function(){u=k=-1;b(this).removeClass("active")}).click(function(a){b(a.target).is("a")||(a=b(this),
location.href=a.find("a").attr("href"))})}h=e.facetAlignment+" top";e=e.facetAlignment+" bottom";m.show();m.position({my:h,at:e,of:c,offset:"0 1",collision:"none"})}})}},200));return!1})};b(".sv-searchform2-portlet").each(function(){var n=b(this),h=l.ObjectUtil.getObjectId(n.attr("id")),c=n.find(".sv-searchform2-result-container"),n=n.find(".sv-searchform2-input");n.attr("autocomplete","off");e({portletId:h,inputField:n,resultDiv:c})})})();
(function(){var b=window.$svjq,l=window.sv,n=l.ObjectUtil,q=l.PortletUtil,e=window.SVBackbone,l=e.Model.extend({getViewUrl:function(){return this.get("url")},isFolder:function(){return this.get("isFolder")}}),p=e.Collection.extend({model:l,initialize:function(b,c){this.portletId=c.portletId;this.currentFolderProps=c.currentFolderProps},url:function(){return q.getPortletResourceUri(this.portletId,"files")},setCurrentFolderProps:function(b){this.currentFolderProps=b},getCurrentFolderProps:function(){return this.currentFolderProps},
parse:function(b){this.setCurrentFolderProps(b.currentFolderProps);return b.items}}),h=e.View.extend({tagName:"tr",events:{"click [data-fetch-item]":"fetchItem"},initialize:function(){this.template=this.options.template;this.model.set("fontClass",this.model.isFolder()?this.options.folderFontClass:this.options.fileFontClass);this.portletView=this.options.portletView},render:function(){this.$el.html(this.template(this.model.toJSON(),this.model));return this},fetchItem:function(b){this.model.isFolder()&&
(b.preventDefault(),this.portletView.fetchFolder(this.model))}}),c=e.View.extend({initialize:function(){this.itemTemplate=this.options.itemTemplate;this.fileFontClass=this.options.fileFontClass;this.folderFontClass=this.options.folderFontClass;this.portletView=null},render:function(){this.clearTable();this.collection.each(function(b){this.appendOne(b)},this)},appendOne:function(b){b=new h({model:b,template:this.itemTemplate,portletView:this.portletView,fileFontClass:this.fileFontClass,folderFontClass:this.folderFontClass});
this.$el.append(b.render().el)},clearTable:function(){this.$el.empty()}}),m=l.extend({isFolder:function(){return!0}}),u=e.View.extend({tagName:"li",events:{"click [data-fetch-folder]":"fetchFolder"},initialize:function(){this.template=this.options.template;this.portletView=this.options.portletView;this.model.set("isActive",this.options.isActive)},render:function(){this.$el.html(this.template(this.model.toJSON(),this.model));return this},fetchFolder:function(b){b.preventDefault();this.portletView.fetchFolder(this.model)}}),
k=e.View.extend({initialize:function(){this.breadcrumbTemplate=this.options.breadcrumbTemplate;this.portletView=null},render:function(){this.clearList();this.collection.each(function(b,c){this.appendOne(b,c===this.collection.length-1)},this)},appendOne:function(b,c){var e=new u({model:b,template:this.breadcrumbTemplate,portletView:this.portletView,isActive:c});this.$el.append(e.render().el)},clearList:function(){this.$el.empty()}}),s=e.View.extend({initialize:function(){this.breadcrumbCollectionView=
this.options.breadcrumbCollectionView;this.breadcrumbCollection=this.breadcrumbCollectionView.collection;this.itemCollectionView=this.options.itemCollectionView;this.itemCollection=this.itemCollectionView.collection;this.breadcrumbCollectionView.portletView=this;this.itemCollectionView.portletView=this},render:function(){this.breadcrumbCollectionView.render();this.itemCollectionView.render()},fetchFolder:function(b){var c=this.itemCollection.getCurrentFolderProps();this.itemCollection.fetch({data:{sharePointFolderId:b.id,
trail:c.trail,trailTime:c.trailTime},context:this}).done(function(c){c.unauthorized?window.location.href=b.getViewUrl():(this.breadcrumbCollection.reset(c.breadcrumbs),this.render())})}});b(".sv-sharepointfile-portlet").each(function(){var h=b(this),l=n.getObjectId(h.attr("id")),u=h.find(".sv-sharepointfile-root"),B=u.data("js-namespace"),v=window.sv[B]||[];if(0!==v.length){var a=u.find(".sv-sharepointfile-breadcrumbs"),u=u.find(".sv-sharepointfile-files tbody"),B=u.data("file-font-class"),x=u.data("folder-font-class"),
A=v.items,D=v.currentFolderProps,F=v.breadcrumbs,v=q.getTemplate(h,"sharepointitem"),h=q.getTemplate(h,"sharepointbreadcrumb"),F=new e.Collection(F,{model:m}),a=new k({el:a,collection:F,breadcrumbTemplate:h}),l=new p(A,{portletId:l,currentFolderProps:D}),l=new c({el:u,collection:l,breadcrumbCollectionView:a,fileFontClass:B,folderFontClass:x,itemTemplate:v});(new s({breadcrumbCollectionView:a,itemCollectionView:l})).render()}})})();
(function(){var b=window.$svjq,l=window.sv;b(".sv-sharepointfile-portlet, .sv-sharepointsearchfilelist-portlet").each(function(){var n=b(this),q=n.find(".sv-sharepoint-login-modal");q.svDialog({title:l.i18n.getText("portlet.sharepoint.sharepointfile","connectToSharePoint"),open:!1,modal:!0,buttons:[{text:l.i18n.getText("portlet.sharepoint.sharepointfile","loginButton"),type:"primary",callback:function(b){b.preventDefault();q.find("form").submit()}},{text:l.i18n.getText("common","cancel"),type:"link",
callback:function(){q.svDialog("close")}}]});n.find(".sv-sharepoint-modal-button").click(function(){q.svDialog("open")})})})();
(function(){function b(){m&&0!==m.length||(m=p("<div/>"));return m}function l(c){c.preventDefault();c=b().find("form");p.post(c.attr("action"),c.serialize(),function(c){n();-1!==c.indexOf('http-equiv="Refresh"')?window.location.href=p("input[name=redirectURL]").attr("value"):0<p(c).find("div#error-messages").length?m=p("<div/>").html(c).svDialog({open:!0,title:p("input[name=windowTitle]").attr("value"),buttons:[{text:p("input[name=buttonText]").attr("value"),type:"primary",callback:l},{text:p("input[name=closeButtonText]").attr("value"),
type:"link",callback:n}]}):(m=b(),u?u.html(c).svDialog("open"):u=p("<div/>").html(c).svDialog({open:!0,title:p("input[name=windowTitle]").attr("value"),buttons:[{text:p("input[name=closeButtonText]").attr("value"),type:"primary",callback:q}]}))})}function n(){m.svDialog("remove")}function q(){u.svDialog("close")}function e(c){c=p("#"+c);m=b();c.on("click",function(b){b.preventDefault();m.svDialog({open:!0,url:this.href,title:p("input[name=windowTitle]").attr("value"),modal:!0,buttons:[{text:p("input[name=buttonText]").attr("value"),
type:"primary",callback:l},{text:p("input[name=closeButtonText]").attr("value"),type:"link",callback:n}]})})}var p=window.$svjq,h=window.sv,c,m,u;if(h.tellfriend2&&h.tellfriend2.length)for(c=0;c<h.tellfriend2.length;c+=1)e(h.tellfriend2[c])})();
